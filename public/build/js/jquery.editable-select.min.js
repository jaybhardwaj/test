!function(e){e.extend(e.expr[":"],{nic:function(e,i,t,s){return!((e.textContent||e.innerText||"").toLowerCase().indexOf((t[3]||"").toLowerCase())>=0)}}),e.fn.editableSelect=function(i){var t={filter:!0,effect:"default",duration:"fast",onCreate:null,onShow:null,onHide:null,onSelect:null},s=this.clone(),l=e('<input type="text">'),n=e('<ul class="es-list">');switch(i=e.extend({},t,i),i.effects){case"default":case"fade":case"slide":break;default:i.effects="default"}isNaN(i.duration)&&"fast"==i.duration&&"slow"==i.duration&&(i.duration="fast"),this.replaceWith(l);var a={init:function(){var t=this;t.copyAttributes(s,l),l.addClass("es-input"),e(document.body).append(n),s.find("option").each(function(){var i=e("<li>");i.html(e(this).text()),t.copyAttributes(this,i),n.append(i),e(this).attr("selected")&&l.val(e(this).text())}),l.on("focus input click",t.show),e(document).click(function(i){e(i.target).is(l)||e(i.target).is(n)||t.hide()}),t.initializeList(),t.initializeEvents(),i.onCreate&&i.onCreate.call(this,l)},initializeList:function(){var i=this;n.find("li").each(function(){e(this).on("mousemove",function(){n.find(".selected").removeClass("selected"),e(this).addClass("selected")}),e(this).click(function(){i.setField.call(this,i)})}),n.mouseenter(function(){n.find("li.selected").removeClass("selected")})},initializeEvents:function(){var e=this;l.bind("input keydown",function(i){switch(i.keyCode){case 40:e.show();var t=n.find("li:visible"),s=t.filter("li.selected");n.find(".selected").removeClass("selected"),s=t.eq(s.size()>0?t.index(s)+1:0),s=(s.size()>0?s:n.find("li:visible:first")).addClass("selected"),e.scroll(s,!0);break;case 38:e.show();var t=n.find("li:visible"),s=t.filter("li.selected");n.find("li.selected").removeClass("selected"),s=t.eq(s.size()>0?t.index(s)-1:-1),(s.size()>0?s:n.find("li:visible:last")).addClass("selected"),e.scroll(s,!1);break;case 13:n.is(":visible")&&(e.setField.call(n.find("li.selected"),e),i.preventDefault());case 9:case 27:e.hide();break;default:e.show()}})},show:function(){n.find("li").show(),n.css({top:l.offset().top+l.outerHeight()-1,left:l.offset().left,width:l.innerWidth()});var e=i.filter?n.find("li:nic("+l.val()+")").hide().size():0;if(e==n.find("li").size())n.hide();else switch(i.effects){case"fade":n.fadeIn(i.duration);break;case"slide":n.slideDown(i.duration);break;default:n.show(i.duration)}i.onShow&&i.onShow.call(this,l)},hide:function(){switch(i.effects){case"fade":n.fadeOut(i.duration);break;case"slide":n.slideUp(i.duration);break;default:n.hide(i.duration)}i.onHide&&i.onHide.call(this,l)},scroll:function(i,t){var s=0,l=n.find("li:visible").index(i);n.find("li:visible").each(function(i,t){i<l&&(s+=e(t).outerHeight())}),(s+i.outerHeight()>=n.scrollTop()+n.outerHeight()||s<=n.scrollTop())&&(t?n.scrollTop(s+i.outerHeight()-n.outerHeight()):n.scrollTop(s))},copyAttributes:function(i,t){var s=e(i)[0].attributes;for(var l in s)e(t).attr(s[l].nodeName,s[l].nodeValue)},setField:function(t){return!!e(this).is("li:visible")&&(l.val(e(this).text()),t.hide(),void(i.onSelect&&i.onSelect.call(l,e(this))))}};return a.init(),l}}(jQuery);