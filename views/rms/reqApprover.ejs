<%include sidebar1.ejs %>
<title>All Requisition</title>
 
<style>
.title1{
    background-color: red;
    height:20px;
}
.content1{
  background-color: green;   
  height:20px;
}
.detailLabelTitle{
    background-color: none;
    color:#2CB8E5;  
    font-size: 14px;  
    font-weight: 2px;

    
}
.detailLabelContent{
    background-color: none;
    color:black;    
    font-size: 12px;
    text-align:center;
}
</style>
    <!---------------------------------View Detail modal box -------------------------------------->  
        <div class="modal fade" id="jdDetailModal" role="dialog">
            <div class="modal-dialog modal-lg">
                <div class="modal-content" style="margin:0px">
                    <div class="modal-header" style="background-color:#2CB8E5;height:40px">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <center>
                            <h4 id="dModalHeading" class="modal-title" style="color:#052F71;font-size:14pt;margin-top:-5px">Requisition Details</h4></center>
                    </div>
                    <div class="modal-body" style="">
                   
                       <div class="row">
                                <div class="col-md-5 col-md-offset-1">
                                     <div class="col-md-6">
                                         <label class="detailLabelTitle" >Job Title :</label>
                                     </div>
                                     <div class="col-md-6">
                                         <label class="detailLabelContent" style=" " id="djobTitle"  ></label>
                                     </div>
                                 </div>
                                <div class="col-md-5 " style="">
                                    <div class="col-md-6">
                                        <label class="detailLabelTitle">Designation :</label>
                                    </div>
                                     <div class="col-md-6">
                                        <label class="detailLabelContent" style=" " id="dbrowsers" ></label>
                                    </div>
                                </div>
                            </div>
                        <br>
                        <div class="row" style="margin-top:2%">
                                <div class="col-md-5 col-md-offset-1">
                                    <div class="col-md-6">
                                     <label class="detailLabelTitle" >Location :</label>
                                 </div>
                                 <div class="col-md-6">
                                     <label class="detailLabelContent" style=" " id="dlocation"  ></label>
                                 </div>
                                 </div>
                                <div class="col-md-5 " style="">
                                    <div class="col-md-6">
                                        <label class="detailLabelTitle">Skills :</label>
                                    </div>
                                     <div class="col-md-6">
                                        <label class="detailLabelContent" style=" " id="dskillsId" ></label>
                                    </div>
                                </div>
                            </div>
                        <br>
                        <div class="row" style="margin-top:2%">
                                <div class="col-md-5 col-md-offset-1">
                                    <div class="col-md-6">
                                     <label class="detailLabelTitle" >Minimum Salary :</label>
                                 </div>
                                 <div class="col-md-6">
                                     <label class="detailLabelContent" style=" " id="dminsal"  ></label>
                                 </div>
                                 </div>
                                <div class="col-md-5 " style="">
                                    <div class="col-md-6">
                                        <label class="detailLabelTitle">Maximum Salary :</label>
                                    </div>
                                     <div class="col-md-6">
                                        <label class="detailLabelContent" style=" " id="dmaxsal" ></label>
                                    </div>
                                </div>
                            </div>
                        <br>
                        <div class="row" style="margin-top:2%">
                                <div class="col-md-5 col-md-offset-1">
                                    <div class="col-md-6">
                                     <label class="detailLabelTitle" ># positions :</label>
                                 </div>
                                 <div class="col-md-6">
                                     <label class="detailLabelContent" style=" " id="dnoOfPositions"  ></label>
                                 </div>
                                 </div>
                                <div class="col-md-5 " style="">
                                    <div class="col-md-6">
                                        <label class="detailLabelTitle">Years Of Experience  :</label>
                                    </div>
                                     <div class="col-md-6">
                                        <label class="detailLabelContent" style=" " id="dyox" ></label>
                                    </div>
                                </div>
                            </div>
                        <br>
                        <div class="row" style="margin-top:2%">
                                <div class="col-md-5 col-md-offset-1">
                                    <div class="col-md-6">
                                     <label class="detailLabelTitle" >Suggested Interviewer :</label>
                                 </div>
                                 <div class="col-md-6">
                                     <label class="detailLabelContent" style=" " id="drec"  ></label>
                                 </div>
                                 </div>
                                <div class="col-md-5 " style="">
                                    <div class="col-md-6">
                                        <label class="detailLabelTitle">Assigned HR  :</label>
                                    </div>
                                     <div class="col-md-6">
                                        <label class="detailLabelContent" style=" " id="dadminhr" ></label>
                                    </div>
                                </div>
                            </div>
                        <br>
                        <div class="row" style="margin-top:2%">
                                <div class="col-md-5 col-md-offset-1">
                                    <div class="col-md-6">
                                     <label class="detailLabelTitle" >Job Type :</label>
                                 </div>
                                 <div class="col-md-6">
                                     <label class="detailLabelContent" style=" " id="djobType"  ></label>
                                 </div>
                                 </div>
                                <div class="col-md-5 " style="">
                                    <div class="col-md-6">
                                        <label class="detailLabelTitle">Priority  :</label>
                                    </div>
                                     <div class="col-md-6">
                                        <label class="detailLabelContent" style=" " id="dpriority" ></label>
                                    </div>
                                </div>
                            </div>
                        <br>
  
                                <div id="" class="row" style="margin-top:2%">
                                    <div class="col-md-10" style="background-color:white;margin-left:8%">
                                        <ul class="nav nav-tabs" style="background-color:none;font-size:13px">
                                            <li class="active"><a data-toggle="tab" style="color:grey" href="#ddiscription">Job Description</a></li>
                                            <li><a data-toggle="tab" style="color:grey" href="#dhistory">History</a></li>                  
                                         </ul>
                                         <div class="tab-content" >                     
                                            <div id="ddiscription" class="tab-pane fade in active" style="margin-top:2%;">
                                            </div>                    
                                            <div id="dhistory" class="tab-pane fade" style="height:100px;overflow-y:scroll">                                                
                                            </div> 
                                        </div>                                 
                                     </div>
                                </div>
                                                  
                           </div>
                        
                    </div>
                </div>
            </div>
        </div>
     
 <!---------------------------------Copy/Edit modal box -------------------------------------->           


 <div class="modal fade" id="mymodal" role="dialog">
            <div class="modal-dialog modal-lg">
                <div class="modal-content" style="margin:0px">
                    <div class="modal-header" style="background-color:#2CB8E5;height:40px">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <center>
                            <h4 id="ModalHeading" class="modal-title" style="color:#052F71;font-size:14pt;margin-top:-5px"></h4></center>
                    </div>
                    <div class="modal-body" style="margin-left:-6%;width:117%">
                        <form onsubmit='return validateForm()' id="raise-requisition" name="myform" class="max-width" method="post" action="/hm/raiseRequisition" style="padding-top:1%">
                            <div class="row">
                                <div class="col-md-4 col-md-offset-1">
                                    <section id="details-filter">
                                        <div class="md-input-container ">
                                            <input name="JobTitle" disabled class="used disabledInput" id="jobTitle" style="width:100%" maxlength="250" required>
                                            <label for="jobTitle" id="ljob" class="disabledInput">Job Title<sup>*</sup></label>
                                        </div>
                                    </section>
                                </div>
                                <div class="col-md-3 " style="position:relative;top:1%;bottom:1%;margin-top:-0.7%">
                                    <section id="details-filter">
                                        <div class="md-input-container ">
                                            <select id="browsers" disabled class="used disabledInput" style="width:100%;" name="designation" required>
                                               
                                            </select>
                                            <label id="ldes" class="disabledInput">Designation<sup>*</sup></label>
                                        </div>
                                    </section>
                                </div>
                                <div class="col-md-3">
                                    <section id="details-filter">
                                        <div class="md-input-container ">
                                            <input type="text"disabled class="used disabledInput" style="width:100%" id='skillsId' name="">
                                               
                                            <label id="lski" class="disabledInput">Skills<sup>*</sup></label>
                                        </div>
                                    </section>
                                </div>
                            </div>
                            <div class="row">
                                <section id="details-filter" class="">
                                    <div class="col-md-3 col-md-offset-1" style="">
                                        <div class="md-input-container ">
                                            <select name="Location" disabled class="used disabledInput" id="location" style="width:100%;" required>
                                                <option></option>
                                               
                                            </select>
                                            <label id="lloc" class="disabledInput">Location<sup>*</sup></label>
                                        </div>
                                    </div>
                                        <div class="col-md-2" style="margin-top:0.5%">
                                        <section id="details-filter" class="">
                                            <div class="md-input-container ">
                                                <input name="" disabled class="used disabledInput" id="nop" type="decimal" style="width:100%" maxlength="3"  >
                                                <label id="lyox" class="disabledInput"># positions </label>
                                            </div>
                                        </section>
                                    </div>
                                  <!--   <div class="col-md-2" style="margin-top:0.5%">
                                        <section id="details-filter" class="">
                                            <div class="md-input-container " id="noOfPositions">
                                                <input name="" disabled class="used disabledInput" id="nop" type="number" style="width:100%" >
                                                <label id="lpos" class=""># positions<sup>*</sup></label>
                                            </div>
                                        </section>
                                    </div> -->
                                    <div class="col-md-2" style="margin-top:0.5%">
                                        <section id="details-filter" class="">
                                            <div class="md-input-container ">
                                                <input name="" disabled class="used disabledInput" id="yox" type="decimal" style="width:100%" maxlength="3" required max="999" min="1">
                                                <label id="lyox" class="disabledInput">Years Of Experience<sup>*</sup></label>
                                            </div>
                                        </section>
                                    </div>
                                     <div class="col-md-3 ">
                                        <div class="md-input-container ">
                                            <input style="width:100%" disabled class="used disabledInput" name="ExpiresOn" id="expiresOn" placeholder="Expires On">
                                            <label id="lexo" class="disabledInput">Expires On:</label>
                                        </div>
                                    </div>
                                </section>
                            </div>
                            <div class="row">
                                <section id="details-filter" class="">                                   
                                    <div class="col-md-3 col-md-offset-1" style="margin-top:0.5%">
                                        <section id="details-filter" class="">
                                            <div class="md-input-container ">
                                                <input name="MinimumSalary" disabled class="used disabledInput" id="minsal" type="number" style="width:100%" min="0" max="1000000000">
                                                <label id="lmin" class="disabledInput">Minimum Salary</label>
                                            </div>
                                        </section>
                                    </div>
                                    <div class="col-md-2" style="margin-top:0.5%">
                                        <section id="details-filter" class="">
                                            <div class="md-input-container ">
                                                <input name="MaximumSalary" disabled class="used disabledInput" id="maxsal" type="number" style="width:100%" min="0" max="10000000000">
                                                <label id="lmax" class="disabledInput">Maximum Salary</label>
                                            </div>
                                            <input name="flag" id="flag1" type="text" style="width:100%" class="hide">
                                            <input name="ide" id="ide" type="text" style="width:100%" class="hide">
                                        </section>
                                    </div>
                                     <div class="col-md-2">
                                        <div class="md-input-container ">
                                            <input name="adminhr" disabled class="used disabledInput" id="adminhr" style="width:100%;"  >
                                         
                                            <label id="ladmin" class="disabledInput">Select Admin-HR<sup>*</sup></label>
                                        </div>
                                    </div>
                                    <div class="col-md-3" style="">
                                        <div class="md-input-container ">
                                            <select name="mailPriority" disabled class="used disabledInput" id="priority" style="width:100%;" required>
                                                <option></option>
                                                
                                            </select>
                                            <label id="lprio" class="disabledInput">Priority</label>                                       
                                        </div>
                                    </div>
                                </section>
                            </div>
                            <div class="row">
                                <section id="details-filter" class="">                                   
                                     
                                     <div class="col-md-3 col-md-offset-1" style="margin-top:0.5%">
                                        <section id="details-filter" class="">
                                            <div class="md-input-container ">
                                                <input name="" disabled class="used disabledInput" id="rec" type="decimal" style="width:100%" maxlength="3"  >
                                                <label id="lyox" class="disabledInput">Suggested Interviewer </label>
                                            </div>
                                        </section>
                                    </div>

                                    <!--<div class="col-md-3 col-md-offset-1">
                                       

                                         <div class="md-input-container " id="noOfPositions">
                                         <input type="text" style="width:140%" disabled class="used disabledInput"  name="RecruiterName" id="rec" >
                                             
                                            <label id='lrec' class="">Suggested Interviewer</label>
                                        </div>

                                    </div> -->
                                     <div class="col-md-2" style="">
                                            <div class="md-input-container ">
                                                 <input disabled class="used disabledInput" id="jType" style="width:100%"  >
                                                <label id="ltype" class="disabledInput">Type</label>
                                            </div>
                                        </div>  
                                </section>

                            </div>
                        
                                <div id="" class="row" style="">
                                    <div class="col-md-10" style="background-color:white;margin-left:8%">
                                        
                                          Job Description                 
                                                          
                                        <div id="jd" class="tab-pane fade in active" style="margin-top:2%;">
                                             <textarea class="ckeditor" name="Description" row="3" id="Description" maxlength="4000" placeholder="JobDescription"></textarea>
                                        </div>  
                                    </div>  
                                </div>
                       
                            <div class="row" style="margin-top:2%;margin-bottom:2%">
                                <div class="col-md-1 col-md-offset-5" id="submitButton">
                                    <button type="submit" class="button bt-small" style="width:200%"><i class="fa fa-save"></i> Submit</button>
                                </div>
                            </div>
                           </div>   
                        </form>
                    </div>
                </div>
            </div>
        </div>
       


  <div class="col-md-11 " style="margin-top:7%;height:auto;margin-left:6%;margin-bottom:4%">
  <div style="float:right;margin-bottom:1%"> Search : <input type="text" id="searchbox"></div>
            <table id="allrequisition" class="table cell-border" style="margin-top:1%;font-size:13px;width:100%;">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Skills</th>
                        <th># Positions</th>
                        <th>Experience</th>
                        <th>Admin HR</th>
                        <th>Status</th>
                        <th>Action</th>
                       
                    </tr>
                </thead>
                <tbody style="margin-top:7%;padding-top:7%" id="tbodyReq">
                    <%for(var i=0;i<pdetails.length;i++){%>
                        <tr id="row_<%=pdetails[i].id%>">
                            <td style="">
                                <a onclick="reqData(<%=pdetails[i].id%>,'show',7)" data-toggle="modal" data-target="#jdDetailModal" style="color:black;cursor:pointer">
                                <%=pdetails[i].title%>
                                </a>
                            </td>
                            <td>
                                <%=pdetails[i].skills%> 
                            </td>
                            <td style="width:10%">
                                <%=pdetails[i].positions%>
                            </td>
                            <td style="width:10%">
                                <%=pdetails[i].experience%>
                            </td>
                                                     
                            <td id="assign_<%=pdetails[i].id%>">
                                <%if(pdetails[i].assignedToName!=null){ console.log(i,pdetails[i].assignedToName)%>
                                    <%=pdetails[i].assignedToName%>
                                        <%}else{%>--
                                            <%}%>
                            </td>                           
                             <%if(pdetails[i].isConfirmed==2){%> 
                                <td><i class="fa fa-check-circle" style="font-size:130%;color:green" title="Approved"></i></td>
                                <td></td>
                                <%}else if(pdetails[i].isConfirmed==-2){%>
                                    <td><i class="fa fa-times-circle" style="font-size:130%;color:red" title="Rejected"></i></td>
                                    <td></td>
                                <%}else {%>
                                <td><i class="fa fa-ellipsis-h" style="font-size:130%;color:grey" title="Pending for your approval"></i></td>
                                <td>
                                    <i class="fa fa-check-circle-o" style="font-size:130%;cursor:pointer;color:#10980E" title="Click to Approve" id="toApprove"  onclick="updateStatusReq(1,<%=pdetails[i].id%>)"></i>
                                    <i class="fa fa-times-circle-o" style="font-size:130%;cursor:pointer;color:#DC2F2F;margin-left:10px" title="Click to Reject" onclick="updateStatusReq(0,<%=pdetails[i].id%>)"></i>
                                </td>
                            <%}%>                         
                        </tr>
                        <%}%>
                </tbody>
            </table>
        </div> 



 <%include ./menu1.ejs%>
 <%include ./footer1.ejs%>

  


  <script type="text/javascript">

 function reqData(id, flag, con) {   
                        $.ajax({
                            url: '/hm/reqData',
                            data: {
                                'id': id
                            },
                            method: 'post',
                            success: function(data) {
                              
                                var flage = flag;
                                var ide = id;
                                var cities = JSON.parse(JSON.stringify(data.result[0]));
                                var skill = JSON.parse(JSON.stringify(data.result[1]));
                                var admin = JSON.parse(JSON.stringify(data.result[2]));
                                var desig = JSON.parse(JSON.stringify(data.result[3]));
                                var info = JSON.parse(JSON.stringify(data.result[8]));
                                var prio = JSON.parse(JSON.stringify(data.result[4]));
                                var dviewinfo=JSON.parse(JSON.stringify(data.result[9]));
                                var arstr = [];
                                test = info;
                                console.log("requesition data",data.result[6]);
                                console.log("requesition data",info[0]);
                                 if (con == 7) { 
                                  
                                        $('#ModalHeading').html("Requisition Details");
                                        $('#submitButton').html('<button type="button " class="button bt-small"  data-dismiss="modal"><i class="fa fa-save"></i>Cancel</button>');
                                        $('#djobTitle').html(dviewinfo[0].title);                                       
                                        $('#dnoOfPositions').html(dviewinfo[0].positions);
                                        $('#dminsal').html(dviewinfo[0].minimumSalary);
                                        $('#dmaxsal').html(dviewinfo[0].maximumSalary);
                                        $('#drec').html(dviewinfo[0].recruiter);
                                        $('#dexpiresOn').html(dviewinfo[0].expireDate);
                                        $('#dyox').html(dviewinfo[0].Experience)
                                        $("#dbrowsers").html(dviewinfo[0].designation);
                                        $('#dpriority').html(dviewinfo[0].priority);
                                        $("#dlocation").html(dviewinfo[0].location);
                                        $("#djobType").html(dviewinfo[0].type);                                       
                                        $("#dadminhr").html(dviewinfo[0].adminHr);

                                        var arr = [];
                                        for (var i = 0; i < JSON.parse(JSON.stringify(data.result[6])).length; i++) {
                                            arr[i] = JSON.parse(JSON.stringify(data.result[6]))[i].skillName;
                                        }
                                        $('#dskillsId').html(arr.toString());
                                        $("#ddiscription").html(dviewinfo[0].description);
                                        //-----History Div---------
                                        $('#dhistoryTable').html('');
                                        var counter=1,cname , desc;
                                        desc=data.result[7][i].description;
                                        for(var i=0;i<data.result[7].length;i++){
                                          $('#dhistoryTable').append("<tr style=padding-top:2%;width:100%;float:left;font-size:14px;color:grey><td style=color:black>"+counter++ +".</td><td>\t"+data.result[7][i].name+" has edited <b style=color:black>"+data.result[7][i].columnName+"</b> to "+desc+" on <b>"+data.result[7][i].date.slice(0,10)+"</b> </td></tr></br>");
                                        }
                                 }
                                 
                             }
                         });
                    }



function updateStatusReq(flag,jdid){

     $.ajax({
            url: '/updateStatusReq',
            data: {
                'jdid': jdid,
                'approve':"approver",
                'flag':flag
            },
            method: 'post',
            success: function(nill) {
              //  alert("Change");
                location.reload();
            }
            });
}

        
               var dataTable= $("#allrequisition").dataTable({
                            "showNEntries": false,
                           // "dom": '<"top"i>rt<"bottom"flp><"clear">',
                           "bFilter": true,
                            "bLengthChange": false ,
                            "bSort":true,
                            "aaSorting": [[ 5, "desc" ]]  ,
                            
                        });    
                 
                    $("#searchbox").keyup(function() {
                        dataTable.fnFilter(this.value);
                    });                

</script>
<style>
 .dataTables_filter {
     display: none;
}
 thead th {
                        text-align: center;
                        background-color: #7FCEE6;
                        color: #4D4E50;
                    }
                    
                    td {
                        text-align: center;
                    }
                     #main-menu {
                        margin-top: 5.6% !important;
                        height: 81.4% !important;
                    }
                      .disabledInput {
                        color: #999!important;
                        background-color: #eeeeee!important;
                    }
                    .button {
                        background-color: #66caec !important;
                        border-bottom: 2px solid #2B6173 !important;
                    }
                    
                    .bt-small {
                        padding: 5px 8px;
                    }

</style>
 <script src="//tinymce.cachefly.net/4.2/tinymce.min.js"></script>
                <script>
                    tinymce.init({
                        selector: '#Description'
                    });
                </script>