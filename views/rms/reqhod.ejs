<% include ../partials/head %>  
    <% include ../partials/adminheader %>

    <title>All Requisition</title>
    <style>
        .detailLabelTitle {
            background-color: none;
            color: #2CB8E5;
            font-size: 14px;
            font-weight: 2px;
        }
        
        .detailLabelContent {
            background-color: none;
            color: black;
            font-size: 12px;
            text-align: center;
        }
        
        #skillsId_chosen {
            width: auto !important;
        } 
    </style>
        <!---------------------------------View Detail modal box -------------------------------------->
      <div class="modal fade" id="jdDetailModal" role="dialog">
            <div class="modal-dialog modal-lg">
                <div class="modal-content" style="margin:0px">
                    <div class="modal-header" style="background-color:#f05f40;height:40px">
                        <button type="button" class="close" data-dismiss="modal" style="margin-top:-10px">&times;</button>
                        <center>
                            <h4 id="dModalHeading" class="modal-title" style="color:white;font-size:14pt;margin-top:-5px">Requisition Details</h4></center>
                    </div>
                    <div class="modal-body" style="">

                        <div class="row">
                            <div class="col-md-5 ">
                                <div class="col-md-6">
                                    <label class="detailLabelTitle">Job Title :</label>
                                </div>
                                <div class="col-md-6">
                                    <label class="detailLabelContent" style=" " id="djobTitle"></label>
                                </div>
                            </div>
                            <div class="col-md-5 " style="">
                                <div class="col-md-6">
                                    <label class="detailLabelTitle">Designation :</label>
                                </div>
                                <div class="col-md-6">
                                    <label class="detailLabelContent" style=" " id="dbrowsers"></label>
                                </div>
                            </div>
                        </div>
                         
                        <div class="row" style="margin-top:10px">
                            <div class="col-md-5 ">
                                <div class="col-md-6">
                                    <label class="detailLabelTitle">Location :</label>
                                </div>
                                <div class="col-md-6">
                                    <label class="detailLabelContent" style=" " id="dlocation"></label>
                                </div>
                            </div>
                            <div class="col-md-5 " style="">
                                <div class="col-md-6">
                                    <label class="detailLabelTitle">Skills :</label>
                                </div>
                                <div class="col-md-6">
                                    <label class="detailLabelContent" style=" " id="dskillsId"></label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row" style="margin-top:10px">
                            <div class="col-md-5 ">
                                <div class="col-md-6">
                                    <label class="detailLabelTitle">Minimum Salary :</label>
                                </div>
                                <div class="col-md-6">
                                    <label class="detailLabelContent" style=" " id="dminsal"></label>
                                </div>
                            </div>
                            <div class="col-md-5 " style="">
                                <div class="col-md-6">
                                    <label class="detailLabelTitle">Maximum Salary :</label>
                                </div>
                                <div class="col-md-6">
                                    <label class="detailLabelContent" style=" " id="dmaxsal"></label>
                                </div>
                            </div>
                        </div>
                         
                        <div class="row" style="margin-top:10px">
                            <div class="col-md-5 ">
                                <div class="col-md-6">
                                    <label class="detailLabelTitle"># positions :</label>
                                </div>
                                <div class="col-md-6">
                                    <label class="detailLabelContent" style=" " id="dnoOfPositions"></label>
                                </div>
                            </div>
                            <div class="col-md-5 " style="">
                                <div class="col-md-6">
                                    <label class="detailLabelTitle">Years Of Experience  :</label>
                                </div>
                                <div class="col-md-6">
                                    <label class="detailLabelContent" style=" " id="dyox"></label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row" style="margin-top:10px">
                            <div class="col-md-5 ">
                                <div class="col-md-6">
                                    <label class="detailLabelTitle">Suggested Interviewer :</label>
                                </div>
                                <div class="col-md-6">
                                    <label class="detailLabelContent" style=" " id="drec"></label>
                                </div>
                            </div>
                            <div class="col-md-5 " style="">
                                <div class="col-md-6">
                                    <label class="detailLabelTitle">Assigned HR  :</label>
                                </div>
                                <div class="col-md-6">
                                    <label class="detailLabelContent" style=" " id="dadminhr"></label>
                                </div>
                            </div>
                        </div>
                        
                         <div class="row" style="margin-top:10px">
                            <div class="col-md-5  ">
                                <div class="col-md-6">
                                    <label class="detailLabelTitle">Expiry Date :</label>
                                </div>
                                <div class="col-md-6">
                                    <label class="detailLabelContent" style=" " id="dexpiresOn"></label>
                                </div>
                            </div>
                            <div class="col-md-5 " style="">
                                <div class="col-md-6">
                                    <label class="detailLabelTitle">Priority  :</label>
                                </div>
                                <div class="col-md-6">
                                    <label class="detailLabelContent" style=" " id="dpriority"></label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row" style="margin-top:10px">
                            <div class="col-md-5  ">
                                <div class="col-md-6">
                                    <label class="detailLabelTitle">Job Type :</label>
                                </div>
                                <div class="col-md-6">
                                    <label class="detailLabelContent" style=" " id="djobType"></label>
                                </div>
                            </div>
                           
                        </div> 
                        <div id="" class="row" style="margin-top:10px;background-color:white;">
                            
                                <ul class="nav nav-tabs" style="background-color:none;font-size:13px">
                                    <li class="active"><a data-toggle="tab" style="color:grey" href="#ddiscription">Job Description</a></li>
                                    <li><a data-toggle="tab" style="color:grey" href="#dhistory">History</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div id="ddiscription" class="tab-pane fade in active" style="margin-top:2%;">
                                    </div>
                                    <div id="dhistory" class="tab-pane fade" style="height:100px;overflow-y:scroll">

                                            <table id="dhistoryTable" style="font-size:12px;margin-top:2%;">
                                            </table>

                                            <p></p>
                                    </div>
                                </div>
                            
                        </div>

                    </div>

                </div>
            </div>
        </div>
        </div>
 



     

        <!---------------------------------Copy/Edit modal box -------------------------------------->
        <div class="modal fade" id="mymodal" role="dialog" style="top:-23px;overflow-y:hidden">
            <div class="modal-dialog modal-lg">
                <div class="modal-content" style="margin:0px;">
                    <div class="modal-header" style="background-color:#f05f40;height:40px">
                        <button type="button" class="close" data-dismiss="modal" style="margin-top:-10px">&times;</button>
                        <center>
                            <h4 id="ModalHeading" class="modal-title" style="color:white;font-size:14pt;margin-top:-5px"></h4></center>
                    </div>
                    <div class="modal-body" >
                        <form onsubmit='return validateForm()' id="raise-requisition" name="myform" class="max-width" method="post" action="/raiseRequisition" style="">


                            <div class="row" style="margin-top:1%;margin-bottom:1%">
                                <div class="col-md-1 col-md-offset-5" id="submitButton">
                                    <!-- <button type="submit" class="button bt-small" style="width:200%"><i class="fa fa-save"></i> Submit</button> -->
                                </div>
                            </div>
                <input name="flag" id="flag1" type="text" style="width:100%" class="hide">
                                            <input name="ide" id="ide" type="text" style="width:100%" class="hide">

          <div class="row ">
                <div class="col-md-4 ">
                    <div class="col-md-4">
                    <label>Job Title<sup class="astrick">*</sup></label>
                    </div>
                    <div class="col-md-8">
                    <input name="JobTitle" id="jobTitle" class="form-control addUsed addDisable" style="width:100%" maxlength="250" required>
                    </div>        
                </div>
                 <div class="col-md-4">
                    <div class="col-md-4">
                    <label>Designation<sup class="astrick">*</sup></label>
                    </div>
                    <div class="col-md-8">
                     <select id="browsers" style="width:100%;" class="form-control addUsed addDisable" name="designation" required>
                            <option value=""></option>
                            <%for(var i = 0 ;i<designation.length;i++){%>
                                <option id="skillsm_<%=designation[i].desigId%>" value="<%=designation[i].desigId%>">
                                    <%=designation[i].desigName%>
                                </option>
                                <%}%>
                        </select>
                    </div>        
                </div>
                <div class="col-md-4">
                    <div class="col-md-4">
                    <label>Skills<sup class="astrick">*</sup></label>
                    </div>
                    <div class="col-md-8">
                    <select max-size="1" multiple class="form-control chosen-select addUsed addDisable" style="max-height:9%;overflow-y:auto;width:100%" id='skillsId' name="skills">
                            <option></option>
                            <%for(var i = 0 ;i<skills.length;i++){%>
                                <option id="skills_<%=skills[i].id%>" value="<%=skills[i].id%>"><%=skills[i].skills%></option>
                                <%}%>
                        </select>
                    </div>        
                </div>
            </div> 
             <div class="row" style="margin-top:5px" >
               <div class="col-md-4">
                    <div class="col-md-4">
                    <label>Location<sup class="astrick">*</sup></label>
                    </div>
                    <div class="col-md-8">
                      <select name="Location" id="location" class="form-control addUsed addDisable" style="width:100%;" required>
                            <option></option>
                            <%for(var i = 0 ;i<cities.length;i++){%>
                                <option id="skills_<%=cities[i].id%>" value="<%=cities[i].id%>">
                                    <%=cities[i].location%>
                                </option>
                                <%}%>
                        </select>
                    </div>        
                </div>
                <div class="col-md-4">
                    <div class="col-md-4">
                    <label># positions<sup class="astrick">*</sup></label>
                    </div>
                    <div class="col-md-8">
                     <input type = 'text'  style = 'display:none;' id = 'locationnameId' name = 'locationName'>
                      <input name="NoOfPostions" placeholder="no. of positions" class="form-control" id="nop" type="number" style="width:100%" required max="9999999" min="1">
                    </div>        
                </div>
                <div class="col-md-4">
                    <div class="col-md-4">
                    <label>Experience<sup class="astrick">*</sup></label>
                    </div>
                    <div class="col-md-8">
                    <input name="YearsOfExp"  class="form-control" id="yox" type="decimal" style="width:100%" maxlength="10" required max="999" min="1">
                    </div>        
                </div>
            </div>
          <div class="row" style="margin-top:5px">
                <div class="col-md-4">
                    <div class="col-md-4">
                    <label>Expires On:<sup class="astrick">*</sup></label>
                    </div>
                    <div class="col-md-8">
                    <input style=" width:100%" class="form-control" placeholder="no. of positions" name="ExpiresOn" id="expiresOn" type="text">
                    </div>        
                </div>
                  <div class="col-md-4">
                    <div class="col-md-4">
                    <label>Admin-HR<sup class="astrick">*</sup></label>
                    </div>
                    <div class="col-md-8">
                   <select name="adminhr" id="adminhr" class="form-control addUsed addDisable" style="width:100%;" required>
                        <option></option>
                        <%for(var i = 0 ;i<adminhr.length;i++){%>
                            <option id="skills_<%=adminhr[i].id%>" value="<%=adminhr[i].id%>">
                                <%=adminhr[i].firstName%>
                            </option>
                            <%}%>
                    </select>
                    </div>        
                </div>
                 <div class="col-md-4">
                    <div class="col-md-4">
                    <label>Priority<sup class="astrick">*</sup></label>
                    </div>
                    <div class="col-md-8">
                     <select name="mailPriority" class="form-control addUsed " id="priority" style="width:100%;" required>
                            <option></option>
                            <%for(var i = 0 ;i<priority.length;i++){%>
                                <option id="priority_<%=priority[i].id%>" value="<%=priority[i].id%>">
                                    <%=priority[i].priority%>
                                </option>
                                <%}%>
                        </select>
                    </div>        
                </div>
            </div>
             <div class="row" style="margin-top:5px">
                 <div class="col-md-4">
                    <div class="col-md-4">
                    <label>Minimum Salary:<sup class="astrick">*</sup></label>
                    </div>
                    <div class="col-md-8">
                    <input name="MinimumSalary" id="minsal" class="form-control addUsed addDisable" type="number" style="width:100%" min="0" max="1000000000">
                    </div>        
                </div>
                <div class="col-md-4">
                    <div class="col-md-4">
                    <label>Maximum Salary:<sup class="astrick">*</sup></label>
                    </div>
                    <div class="col-md-8">
                     <input name="MaximumSalary" id="maxsal" class="form-control addUsed addDisable" type="number" style="width:100%" min="0" max="10000000000">
                    </div>        
                </div>
                <div class="col-md-4">
                    <div class="col-md-4">
                    <label>Suggested Interviewer:<sup class="astrick">*</sup></label>
                    </div>
                    <div class="col-md-8">
                    <input name="RecruiterName" class="form-control addUsed addDisable" id="rec" type="text" style="width:100%" maxlength="50">
                    </div>        
                </div>
            </div>          
            <div class="row" style="margin:1%">
                <ul class="nav nav-tabs" style="background-color:none;font-size:13px">
                    <li class="active"><a data-toggle="tab" style="color:grey" href="#jd">Job Description</a></li>
                    <li><a data-toggle="tab" style="color:grey" href="#history">History</a></li>
                </ul>
                <div class="tab-content">
                    <div id="jd" class="tab-pane fade in active" style="margin-top:2%;">
                        <textarea class="ckeditor" name="Description" row="3" id="Description" maxlength="4000" placeholder="JobDescription"></textarea>
                    </div>
                    <div id="history" class="tab-pane fade" style="height:100px;overflow-y:scroll">

                        <table id="historyTable" style="font-size:12px;margin-top:2%;">
                        </table>

                        <p></p>
                    </div>
                </div>
            </div>
                           

                            <div class="row" style="margin-top:1%;margin-bottom:1%">
                                <div class="col-md-1 col-md-offset-5" id="submitButton">
                                    <button type="submit" class="button bt-small" style="width:200%"><i class="fa fa-save"></i> Submit</button>
                                </div>
                            </div>
                            </form>
                    </div>
                    
                </div>
            </div>
        </div>

        <!-----------------------------Main Page Content-------------------------->
    <div class="row" style="padding-top:4%;background-color:antiquewhite">
<center> <label id="" class=" " style="font-size:14pt;color:#f05f40;"><b>All Requisition</b></label></center>
    <div style="margin:1%;margin-top: 0px">
       <div style="float:right;margin-bottom:1%"> Search : <input type="text" id="searchbox"></div>
        <table id="allrequisition" class="table cell-border" style="font-size:13px;width:100%;">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Skills</th>
                    <th># Positions</th>
                    <th>Experience</th>
                    <th>Admin HR</th>
                    <th>Status</th>
                    <th>Action</th>

                </tr>
            </thead>
            <tbody style="margin-top:7%;padding-top:7%" id="tbodyReq">
                <%for(var i=0;i<pdetails.length;i++){%>
                    <tr id="row_<%=pdetails[i].id%>">
                        <td style="">
                            <a onclick="reqData(<%=pdetails[i].id%>,'show',7)" data-toggle="modal" data-target="#jdDetailModal" style="color:black;cursor:pointer">
                                <%=pdetails[i].title%>
                            </a>
                        </td>
                        <td>
                            <%=pdetails[i].skills%>
                        </td>
                        <td style="width:10%">
                            <%=pdetails[i].positions%>
                        </td>
                        <td style="width:10%">
                            <%=pdetails[i].experience%>
                        </td>

                        <td id="assign_<%=pdetails[i].id%>">
                            <%if(pdetails[i].assignedToName!=null){%>
                                <%=pdetails[i].assignedToName%>
                                    <%}else{%>--
                                        <%}%>
                        </td>
                        <%if(pdetails[i].isConfirmed==2){%>
                            <td><i class="glyphicon glyphicon-ok" style="font-size:130%;color:green" title="Approved"></i></td>
                            <td>
                                <span><i class="glyphicon glyphicon-book" id="clone_<%=i%>" data-toggle='modal' data-target='#mymodal' style = "color:gray;margin:2%;" title = "Copy" onclick = "reqData(<%=pdetails[i].id%>,'copy',<%=pdetails[i].isConfirmed%>)"></i></span><span style="padding-right:5px;padding-left:5px"><i class="glyphicon glyphicon-pencil" data-toggle='modal' data-target='#mymodal' id="pencil_<%=i%>"style="color:gray;margin:2%;" onclick="reqData(<%=pdetails[i].id%>,'edit',<%=pdetails[i].isConfirmed%>)" title="Edit">
                                </td>
                                <%}else if(pdetails[i].isConfirmed==-1||pdetails[i].isConfirmed==-2){%>
                                    <td><i class="glyphicon glyphicon-remove" style="font-size:130%;color:red" title="Rejected"></i></td>
                                    <td></td>
                                <%}else if(pdetails[i].isConfirmed==1){%>
                                <td><i class="glyphicon glyphicon-option-horizontal" style="font-size:130%;color:black" title="Pending for 2nd Level of approval"></i>
                                </td>
                                    <td>
                                         <span><i class="glyphicon glyphicon-book" id="clone_<%=i%>" data-toggle='modal' data-target='#mymodal' style = "color:gray;margin:2%;" title = "Copy" onclick = "reqData(<%=pdetails[i].id%>,'copy',<%=pdetails[i].isConfirmed%>)"></i></span><span style="padding-right:5px;padding-left:5px"><i class="glyphicon glyphicon-pencil" data-toggle='modal' data-target='#mymodal' id="pencil_<%=i%>"style="color:gray;margin:2%;" onclick="reqData(<%=pdetails[i].id%>,'edit',<%=pdetails[i].isConfirmed%>)" title="Edit">
                                    </td>    
                                <%}else if(pdetails[i].isConfirmed==0){ %>
                                    <%if(pdetails[i].createdBy==id){  %>
                                        <td><i class="glyphicon glyphicon-option-horizontal" style="font-size:130%;color:black" title="Pending for 2nd Level of approval"></i>
                                        </td>
                                        <td><span><i class="glyphicon glyphicon-book" id="clone_<%=i%>" data-toggle='modal' data-target='#mymodal' style = "color:gray;margin:2%;" title = "Copy" onclick = "reqData(<%=pdetails[i].id%>,'copy',<%=pdetails[i].isConfirmed%>)"></i></span><span style="padding-right:5px;padding-left:5px"><i class="glyphicon glyphicon-pencil" data-toggle='modal' data-target='#mymodal' id="pencil_<%=i%>"style="color:gray;margin:2%;" onclick="reqData(<%=pdetails[i].id%>,'edit',<%=pdetails[i].isConfirmed%>)" title="Edit"></i></span><span><i class="glyphicon glyphicon-delete" id = "trash_<%=i%>" style = "color:gray;margin:2%;" title = "Delete" onclick = "delteRequisition(this.id)"></i></span></td>
                            <%}else{%>
                                <td><i class="glyphicon glyphicon-option-horizontal" style="font-size:130%;color:grey" title="Pending for your approval"></i></td>
                                <td>
                                    <i class="glyphicon glyphicon-ok" style="font-size:130%;cursor:pointer;color:#10980E" title="Click to Approve" id="toApprove" onclick="updateStatusReq(1,<%=pdetails[i].id%>)"></i>
                                    <i class="glyphicon glyphicon-remove" style="font-size:130%;cursor:pointer;color:#DC2F2F;margin-left:10px" title="Click to Reject" onclick="updateStatusReq(0,<%=pdetails[i].id%>)"></i>
                                </td>
                                <%}}else {%>
                                    <td></td>
                                    <td></td>
                                    <%}%>

                    </tr>
                    <%}%>
            </tbody>
        </table>
        </div>
    </div>


    <!--PAGE CONTENT ENDS-->
<%include menu1.ejs%>
<% include ../partials/footer %> 
 
  
 
            <script type="text/javascript">
                function reqData(id, flag, con) {
                    $('#flag1').val(flag);
                    $('#ide').val(id);
                    $.ajax({
                        url: '/reqData',
                        data: {
                            'id': id
                        },
                        method: 'post',
                        success: function(data) {
                            console.log(data);
                                var flage = flag;
                                var ide = id;
                                var cities = JSON.parse(JSON.stringify(data.result[0]));
                                var skill = JSON.parse(JSON.stringify(data.result[1]));
                                var admin = JSON.parse(JSON.stringify(data.result[2]));
                                var desig = JSON.parse(JSON.stringify(data.result[3]));
                                var info = JSON.parse(JSON.stringify(data.result[5]));
                                var dviewinfo = JSON.parse(JSON.stringify(data.result[9]));
                                var prio = JSON.parse(JSON.stringify(data.result[4]));
                                var arstr = [];
                                test = info;
                               
                                    $("#location").val(info[0].location);
                                    $("#adminhr").val(info[0].adminHr);
                                    $("#browsers").val(info[0].designation);
                                    $('#jobTitle').val(info[0].title);
                                    $('#nop').val(info[0].positions);
                                    $('#minsal').val(info[0].minimumSalary);
                                    $('#maxsal').val(info[0].maximumSalary);
                                    $("#priority").val(info[0].priority);
                                    $('#expiresOn').val(info[0].expireDate);
                                    tinyMCE.activeEditor.setContent(info[0].description);
                                    //$('#Description').html(info[0].description);
                                    $('#yox').val(info[0].Experience);
                                    $('#rec').val(info[0].recruiter);
                                    $('#jobType').val(info[0].jobType);
                                    $('#history').val(info[0].jobType);
                                    var arr = [];
                                    for (var i = 0; i < JSON.parse(JSON.stringify(data.result[6])).length; i++) {
                                        console.log(JSON.parse(JSON.stringify(data.result[6]))[i].skill);
                                        arr[i] = JSON.parse(JSON.stringify(data.result[6]))[i].skill
                                        $('#skills_' + JSON.parse(JSON.stringify(data.result[6]))[i].skill).prop('selected', true);
                                    }
                                    $('#skillsId').val(arr.toString().split(',')).trigger('change');

                                    $('#skillsId').trigger('chosen:updated');
                                    $('#skillsId').prop('disabled', false).trigger("chosen:updated");
                                    
                                      $('#historyTable').html('');
                                    var counter = 1;
                                    var cname;
                                    var desc; 
                                    for (var i = 0; i < data.result[8].length; i++) {
                                         desc = data.result[8][i].description;
                                         console.log("Hiss ",desc);
                                        $('#historyTable').append("<tr style=padding-top:2%;width:100%;float:left;font-size:14px;color:grey><td style=color:black>" + counter++ + ".</td><td>\t" + data.result[8][i].name + " has edited <b> style=color:black>" + data.result[8][i].columnName + "</b> to " + desc + " on <b>" + data.result[8][i].date.slice(0, 10) + "</b> </td></tr></br>");
                                    }

                                //--------------View Detail Pop-Up
                                if (con == 7) {
                                    $('#ModalHeading').html("Requisition Details");
                                  
                                    $('#djobTitle').html(dviewinfo[0].title);
                                    $('#dnoOfPositions').html(dviewinfo[0].positions);
                                    $('#dminsal').html(dviewinfo[0].minimumSalary);
                                    $('#dmaxsal').html(dviewinfo[0].maximumSalary);
                                    $('#drec').html(dviewinfo[0].recruiter);
                                    $('#dexpiresOn').html(dviewinfo[0].expireDate);
                                    $('#dyox').html(dviewinfo[0].Experience)
                                    $("#dbrowsers").html(dviewinfo[0].designation);
                                    $('#dpriority').html(dviewinfo[0].priority);
                                    $("#dlocation").html(dviewinfo[0].location);
                                    $("#djobType").html(dviewinfo[0].type);
                                    $("#dadminhr").html(dviewinfo[0].adminHr);

                                    var arr = [];
                                    for (var i = 0; i < JSON.parse(JSON.stringify(data.result[6])).length; i++) {
                                        arr[i] = JSON.parse(JSON.stringify(data.result[6]))[i].skillName;
                                    }
                                    $('#dskillsId').html(arr.toString());
                                    $("#ddiscription").html(dviewinfo[0].description);
                                    //-----History Div---------
                                    $('#dhistoryTable').html('');
                                    var counter = 1;
                                    var cname;
                                    var desc;
                                    
                                    for (var i = 0; i < data.result[8].length; i++) {
                                        desc = data.result[8][i].description;
                                        $('#dhistoryTable').append("<tr style=padding-top:2%;width:100%;float:left;font-size:14px;color:grey><td style=color:black>" + counter++ + ".</td><td>\t" + data.result[8][i].name + " has edited <b style=color:black>" + data.result[8][i].columnName + "</b> to " + desc + " on <b>" + data.result[8][i].date.slice(0, 10) + "</b> </td></tr></br>");
                                    }
                                }
                                if (flag == "copy") {
                                    //free to edit
                                    $('#ModalHeading').html("Raise Requisition");
                                    $('.addUsed').addClass("used");
                                    $('.addDisable').attr('disabled', false); 
                                     $(".chosen-select").prop('disabled', false).trigger('chosen:updated');

                                }
                                if (flag == "edit") {
                                    $('#ModalHeading').html("Edit Requisition");
                                    
                                    if (con == 0) { // show everything and edit everything
                                        $('.addUsed').addClass("used");
                                        $('.addDisable').attr('disabled', false); 
                                         $(".chosen-select").prop('disabled', false).trigger('chosen:updated');  
                                    }
                                    if (con == 2 || con == 1) {
                                        //partial editing is allowed
                                        
                                        $('.addUsed').addClass("used");
                                        $('.addDisable').attr('disabled', true);
                                        $(".addDisable").css("color", "grey");
                                         $(".chosen-select").prop('disabled', true).trigger('chosen:updated');
                                    }
                                }
                            }
                    });
                }



                function updateStatusReq(flag, jdid) {
                    if(flag==0){
                        if (!confirm('Are you sure you want to REJECT this Requisition')) {
                        return false;
                        }
                    }
                    if(flag==1){
                        if (!confirm('Are you sure you want to APPROVE this Requisition')) {
                        return false;
                        }
                    }  
                   // alert(flag);                  
                    $.ajax({
                        url: '/updateStatusReq',
                        data: {
                            'jdid': jdid,
                            'flag': flag,
                            'approve': "hod",
                        },
                        method: 'post',
                        success: function(nill) {                           
                            location.reload();
                        }
                    });
                }



                var dataTable = $("#allrequisition").dataTable({
                    "showNEntries": false,
                    // "dom": '<"top"i>rt<"bottom"flp><"clear">',
                    "bFilter": true,
                    "bLengthChange": false,
                    "bSort": true,
                    "aaSorting": [
                        [5, "desc"]
                    ],
                    "columnDefs": [{
                        className: "dt-body-left",
                        "targets": [6]
                    }]
                });

                $("#searchbox").keyup(function() {
                    dataTable.fnFilter(this.value);
                });

                $(document).ready(function() {

                     jQuery('#expiresOn').datetimepicker({
                            i18n: {
                                de: {
                                    months: [
                                        'Januar', 'Februar', 'März', 'April',
                                        'Mai', 'Juni', 'Juli', 'August',
                                        'September', 'Oktober', 'November', 'Dezember',
                                    ],
                                    dayOfWeek: [
                                        "So.", "Mo", "Di", "Mi",
                                        "Do", "Fr", "Sa.",
                                    ]
                                }
                            },
                            timepicker: false,
                            format: 'd.m.Y'
                        });

                    if (<%=flag==1%>) {
                        alert('Requisition created');
                    }
                    if (<%=flag==0%>) {
                        alert('Requisition edited');
                    }
                });
            </script>
            <style>
                .dataTables_filter {
                    display: none;
                }
                
                thead th {
                    text-align: center;
                    background-color: #7FCEE6;
                    color: #4D4E50;
                }
                
                td {
                    text-align: center;
                }
                
                #main-menu {
                    margin-top: 5.6% !important;
                    height: 81.4% !important;
                }
                
                .disabledInput {
                    color: #999!important;
                    background-color: #eeeeee!important;
                }
                
                .button {
                    background-color: #66caec !important;
                    border-bottom: 2px solid #2B6173 !important;
                }
                
                .bt-small {
                    padding: 5px 8px;
                }
            </style>
          

            <script>
                tinymce.init({
                    selector: '#Description'
                });
            </script>