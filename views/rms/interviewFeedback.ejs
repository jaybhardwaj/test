<title>
    Feedback</title>

    <% include ../partials/head %>
    <%include menu1.ejs%>
        <% include ../partials/adminheader %>

            <style>
               
                .labText{
                    color: darkgray;
                    font-size: 12px;
                }
                
                #main-menu {
                    margin-top: 5%;
                }
                
                .textmargintop {
                    margin-top: 10px;
                }
                
           
                
                .tip {
                    width: 0px;
                    height: 0px;
                    position: absolute;
                    background: transparent;
                    border: 10px solid #00B9F5;
                }
                
                .tip-right {
                    top: -3px;
                    right: -25px;
                    border-top-color: transparent;
                    border-right-color: transparent;
                    border-bottom-color: transparent;
                }
                
                .dialogbox .body {
                    position: relative;
                    height: auto;
                    margin: 20px 10px;
                    background-color: #00B9F5;
                    border-radius: 3px;
                    border: 5px solid #00B9F5;
                }
                
                .body .message {
                    border-radius: 3px;
                    font-family: Arial;
                    font-size: 12px;
                    line-height: 1.5;
                    color: #fff;
                }
                
                .verticalLine0 {
                    border-left: thick solid #F3B293;
                }
                
                .verticalLine1 {
                    border-left: thick solid #95CCF1;
                }
                
                .verticalLine2 {
                    border-left: thick solid #B1F3BC;
                }
                
                .verticalLine3 {
                    border-left: thick solid #EAA4AE;
                }
                
                .verticalLine4 {
                    border-left: thick solid #F3EC96;
                }
                
                .verticalLine5 {
                    border-left: thick solid #F3B293;
                }
                .form-text-box{
                  width: 90%;
                }
            </style>

            <body>
                <div class="secondry-color" style="padding-top:5%; overflow: hidden;"> 
                    <center> <label id="" class="modal-title"> Interview Feedback </label></center>

                   <div class="row" style="padding: 5%;padding-top: 0%;padding-bottom: 2%">
                        <form action="interviewData" enctype="multipart/form-data" method="post">
                            <input type="text" class="hide" name="id" id="id">
                            <input type="text" class="hide" name="stateId" id="stateId">
                            <input type="text" class="hide" name="cdtid" id="cdtid">
                            <input type="text" class="hide" name="modeid" id="modeid">
                            <input type="text" class="hide" name="rounds" id="rounds">
                            <input type="text" class="hide" name="jdid" id="jdid">


<div class="table-responsive">
                            <table style="padding:1%;width:100%;" class="table" align="left">

                                <tbody style="">
                                    <tr>
                                        <td><span class="form-Label">Candidate Name : </span> </td>
                                        <td class="labText">
                                            <%=cdt[0].name%>
                                        </td>

                                        <td><span class="form-Label">Interview Category : </span></td>
                                        <td class="labText">
                                            <%=cdt[0].stateName%>
                                        </td>
                                        <td><span class="form-Label">JD Title : </span></td>
                                        <td class="labText">
                                            <%=cdt[0].title%>
                                        </td>
                                    </tr>
                                    <tr style="height:10px"></tr>
                                    <tr>
                                        <td><span class="form-Label">Candidate's Skills: </span></td>
                                        <td class="labText">
                                            <%=cdt[0].skills%>
                                        </td>
                                        <td><span class="form-Label">Rating <sup class="astrick">*</sup>:</span></td>
                                        <td> <input class="addDissable form-text-box" min="0" max="10"  type="number" name="rating" id="rating" placeholder="/10"  ></td>
                                        <td><span class="form-Label">Current Round : </span></td>
                                        <td class="labText">
                                            <%=cdt[0].rounds%>
                                        </td>
                                    </tr>
                                    <tr style="height:10px"></tr>
                                    <tr>
                                        <td><span class="form-Label">Contact No. : </span> </td>
                                        <td class="labText">
                                            <%=cdt[0].phone%>
                                        </td>
                                        <td>
                                            <span class="form-Label">Status <sup class="astrick">*</sup> :</span></td>
                                        <td>
                                            <select id="status" name="status" class="addDissable form-text-box"  >

      <option value="0">--select--</option>
                                                <option value="1">Approved</option>
                                                <option value="2">Rejected</option>
                                                 <option value="3">On Hold</option>
                                            </select> 
                                        </td>
                                        <td><span class="form-Label">Type :</span></td>
                                        <td class="labText">
                                            <%=cdt[0].stateName%>
                                        </td>
                                    </tr>
                                    <tr style="height:10px"></tr>
                                    <tr>
                                        <td><span class="form-Label">Email Id : </span></td>
                                        <td class="labText">
                                            <%=cdt[0].emailID%>
                                        </td>
                                        <td><span class="form-Label">Time Taken <sup class="astrick">*</sup>:</span></td>
                                        <td> <input class="addDissable form-text-box" type="number" min="0" max="999" name="time" id="time" placeholder="min."  ></td>
                                        <td><span class="form-Label">Mode :</span></td>
                                        <td class="labText">
                                            <%=cdt[0].mode%>
                                        </td>
                                    </tr>
                                    <tr style="height:10px"></tr>
                                    <tr>
                                        <td><span class="form-Label"> Download Resume : </span></td>

<td><a href="<%=cdt[0].resumeTitle.replace('/public', '')%>" download><span  class='glyphicon glyphicon-save' style='color:#f05f40;font-size: 15px;cursor:pointer'title ='Download Resume'></span></a></td>
                                        <td>

                                        <td>
                                            <span class="form-Label">Remarks<sup class="astrick">*</sup>:</span></td>
                                        <td>
                                            <textarea placeholder="add your comment" class="addDissable form-text-box" row="10"  name="remarks" id="remarks" style=" height: 63px;resize:none"></textarea>
                                            (max. 500 characters)
                                        </td>
                                        <td id="feedL"  >
                                            <span class="form-Label">Upload Feedback :</span>
                                            </td>
                                            <td id="feedT">
                                            <input type="file" style=" " name="feedback" id="feedback">
                                        </td>
                                    </tr>
                                    <tr>
                                    <td >
                                        <span class="form-Label"> View History :</span>
                                    </td>
                                    <td>
                                        <span data-toggle="modal" onclick="scheduleInfo()" data-target="#historyModal" class="glyphicon glyphicon-eye-open" id="history" style='color:#f05f40;font-size: 15px;cursor:pointer' ></span>
                                    </td>
                                    <td></td>
                                        <td>
                                         
                                           <button type="submit" class="button  btn" onClick="return validateSubmit()" style="width:90px;margin-top: 20px"><i class="fa fa-save"></i> Submit</button>
                                        </td>
                                        <td> <a class="form-Label" href="/rms" style="float:left;margin-left:6%">View all Interviews</a></td>
                                        <td>
                                           
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        </form>
                    </div>
                </div>

            <% include ../partials/footer %>
            </body>

           



                <div class="modal fade" id="historyModal" style="padding-right:20%;height:auto;width:auto">
                    <div class="modal-dialog">
                        <div class="modal-content" id="express2" style="">
                            <div class="modal-header" style="background-color:#f05f40;height:40px">
                                <center>
                                    <h4 id="dModalHeading" class="modal-title" style="color:white;font-size:14pt;margin-top:-5px">Candidate's History</h4>
                                    <button type="button" class="close" data-dismiss="modal" style="margin-top:-28px;float:right">&times;</button>
                                </center>
                            </div>


                            <div id="showhistorydiv" class="table-responsive" style="border:solid 2px #f05f40;margin:20px 10px 0px 10px;overflow-x:scroll;overflow-y:scroll;max-width:100%;max-height:300px">
                                <table style="margin:10px;float:left">
                                    <tbody id="historytable">


                                    </tbody>
                                </table>
                            </div>


                        </div>
                    </div>

                </div>

                <div class="modal fade" id="iremarkmodal" style="height:auto">
                    <div class="modal-dialog">
                        <div class="modal-content" id="express2">
                            <div class="modal-header" style="background-color:#f05f40;height:40px">
                                <center>
                                    <h4 id="head4" class="modal-title" style="color:#052F71;font-size:14pt;margin-top:-5px"><b>Interviewer's Remark</b> 
                    <span  class='glyphicon glyphicon-remove  closeirem' data-dismiss="modal" style='color:#06394A;height:20px;float:right'title ='Close' > 
                    </h4>
                                </center>
                            </div>


                            <div class="modal-body" id="iremarkdiv" style="margin:20px">

                            </div>
                        </div>
                    </div>
                </div>





                <script type="text/javascript">


                   $(document).ready(function() {
                        $("#id").val(<%=cdt[0].id%>);
                        $("#cdtid").val(<%=cdt[0].cdtid%>);
                        $("#modeid").val(<%=cdt[0].modeId%>);
                        $("#stateId").val(<%=cdt[0].stateId%>);
                        $("#rounds").val(<%=cdt[0].rounds%>);
                        $('#jdid').val(<%=cdt[0].requisitionId%>);

                        var flag = <%=flag%>;
                        
                        if (flag) {
                            var isFile = '<%=cdt[0].feedbackForm%>';
                            $('#rating').val(<%=cdt[0].rating%>);
                            $('#status').val(<%=cdt[0].statusId%>);
                            $('#time').val('<%=cdt[0].timeTaken%>');
                            $('#remarks').html('<%=cdt[0].remarks%>');

                            if (isFile) {
                                $('#feedL').html("<span class='title'>Download your Feedback:</span>");
                                $("#feedT").html("<a href='/attach/feedback/<%=cdt[0].feedbackForm%>'  download><span  class='glyphicon glyphicon-save' style='color:#f05f40;height:10px;cursor:pointer; 'title ='Download feedback form'></span>");
                                $('button[type="submit"]').attr('disabled', 'disabled')
                            } else {
                                $('button[type="submit"]').attr("disabled", false);
                            }
                            $('.addDissable').attr('disabled', true);;
                            $('.addDissable').css("color", "grey");
                            $('.addDissable').css("cursor", "auto-scroll");

                        }
                    });

                    $('#history').click(function() {
                        $('#showhistorydiv').toggle();
                    })

                    function scheduleInfo() {

                        $("#showhistorydiv").hide();
                        $.ajax({
                            url: '/getscheduleInfo',
                            type: 'post',
                            data: {
                                "cid": <%=cdt[0].cdtid%>
                            },
                            success: function(data) {


                                $('#historytable').html('');
                                var t = 0;
                                var clr = 0;
                                var jdtemp = [];
                                var jdcount = [];
                                var temparr = [];
                                for (var i = 0; i < data[5].length; i++) {
                                    jdtemp.push(data[5][i].title);
                                }

                                for (var i = 0; i < jdtemp.length; i++) {
                                    temparr[jdtemp[i]] = (temparr[jdtemp[i]] || 0) + 1;  
                                }

                                for (var i in temparr) {
                                    jdcount.push(temparr[i]);
                                }

                                if(data[5][t].firstName===null){
                                    data[5][t].firstName="HR";
                                }
                                for (var i = 0; i < jdcount.length; i++) {
                                    $('#historytable').append("<tr>");
                                    var temp = 0;
                                    for (var j = 0; j < jdcount[i]; j++) {
                                        if (temp == 0) {
                                            $('#historytable').append('<td><span class=""></span><div class="dialogbox"><div class="body"><div class="message"><span>' + data[5][t].title + '</span></div></div></div></td>');
                                            temp++;
                                        }
                                        var irem = '';
                                        var date = data[5][t].date;
                                        date = date.slice(0, 10);
                                        if (data[5][t].interviewerRemarks != null) {
                                            data[5][t].interviewerRemarks = JSON.stringify(data[5][t].interviewerRemarks);
                                            data[5][t].interviewerRemarks = data[5][t].interviewerRemarks.replace(/"/g, '"');
                                            irem = "<span class='glyphicon glyphicon-comment' onclick='interviewerRemarks(" + data[5][t].interviewerRemarks + ")' data-toggle='modal' data-target='#iremarkmodal' style='color:#06394A;height:20px;float:right;color:#337EB7' title =" + data[5][t].interviewerRemarks + " ></span>";
                                        }
                                        $('#historytable').append('<td class="verticalLine' + clr + '"><div style="margin:2px"><div style="font-size:11px"><u>' + data[5][t].stateName + "-" + data[5][t].rounds + '</u>' + irem + '</div><div style="font-size:10px">' + data[5][t].statusName + '</div><div style="font-size:10px">By- ' + data[5][t].firstName + '</div><div style="font-size:10px">On -' + date + '</div></div></td>');
                                        t++;
                                        clr++;
                                        if (clr == 5)
                                            clr = 0;
                                    }
                                    $('#historytable').append("</tr><tr style='height:3px'><td></td><td></td><td></td>)<td></td>;<td></td><td></td> <td></td> <td></td> <td></td><td></td> <td></td> </tr>");
                                }

                            }
                        });
                    }

                    function interviewerRemarks(msg) {
                        $('#iremarkdiv').html("<label>" + msg + "</label>");
                    }

                 

                    function validateSubmit() {
                        
                        var arrExt=["pdf","doc","docx","xlsx","xls"]
                        var filename=$('#feedback').val();
                        
                        var fileExt=filename.split('.');
                        fileExt=fileExt[fileExt.length-1];
                         if(fileExt.length){
                              if(arrExt.indexOf(fileExt) == -1){
                            alert("uploaded file format is invalid! \n valid formats: pdf,doc,docx.xls,xlsx");
                             return false;
                            }
                         }
                      
                        if ($('#rating').val().trim() > 10 || $('#rating').val().trim() < 0 || $('#rating').val().trim().length <= 0) {
                            alert("Rating must be between 0-10");
                            return false;
                        }
                        if ($('#status').val() == 0) {
                            alert("Select a STATUS");
                            return false;
                        }
                        if ($('#time').val().trim().length <= 0) {
                            alert("Enter Time Taken");
                            return false;
                        }
                        if (isNaN($('#time').val())) {
                            alert("Enter Valid Time Taken");
                            return false;
                        }
                        if ($('#remarks').val().trim().length <= 0) {
                            alert("Remarks field can not be empty");
                            return false;
                        }
                        if ($('#remarks').val().trim().length >500) {
                            alert("Remarks can not be more than 500  characters");
                            return false;
                        }
                         

                        alert("Response Submited Successfully!!");
                    }
                   
                </script>
