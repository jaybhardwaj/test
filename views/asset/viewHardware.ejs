<!DOCTYPE html>
<html lang="en">
 
<head>

     <% include ../partials/head %>
       <% include assetheader %>
       <% include ../partials/adminheader %>
</head>
<style type="text/css">
   .dataTables_filter, .dataTables_length {
     display: none;
    }
</style>
<body >
 
 <div class="container-fluid secondry-color" style="padding-top:1%;min-height: 350px">
 
  
  <a href="/hardware" type="button" title="Add New Stationary"  value="Addstationary"><img   class="addNewPlus" ></a>
    
     <span class="modal-title" style="padding-left:41%;">List Of All Hardware</span>
 <input class="form-text-box" type="text" placeholder="search in this table" id="searchbox" style="float:right;width: 13%"> 
  <table class="table table-hover table-striped table-bordered rceDataTable"id="hardtable" cellpadding="0" cellspacing="0" border="0"style="width:100%">
    <thead>

      <tr>
        <th style='background-color:grey;color:white'>Hardware Type</th>
        <th style='background-color:grey;color:white'>Quantity</th>
        <th style='background-color:grey;color:white'>Vendor</th>
        <th style='background-color:grey;color:white'>Invoice Date</th>
        <th style='background-color:grey;color:white'>Invoice No.</th>
        <th style='background-color:grey;color:white'>Invoice Amount</th>
        <th style='background-color:grey;color:white'>Purchase Order</th>
        <th style='background-color:grey;color:white'>Delivery Date</th>
        <th style='background-color:grey;color:white'>Edit/Delete</th>
      </tr>
      <tbody>
        <%for(var i=0;i<htype.length;i++){%>
        <tr>
          <td><%=htype[i].componentName%></td>
          <td><%=htype[i].quantity%></td>
          <td><%=htype[i].vendor%></td>
         <!--  <td><%=((htype[i].invoiceDate).toString()).slice(3,16)%></td> -->
          <td><%=htype[i].invoiceDate%></td>
          <td><%=htype[i].invoiceNo%></td>
          <td><%=htype[i].invoiceAmt%></td>   
          <td><%=htype[i].purchaseOrder%></td>
          <td><%=htype[i].deliveryDate%></td>
          <td>
            <a data-toggle='modal' data-target='#editHardware' onclick="showInfo(<%=htype[i].id%>,0)">
              <span class='glyphicon glyphicon-pencil' style='color:green;margin: 3px'  title ='Edit'></span>
            </a>
             <a data-toggle='modal' data-target='#editHardware' onclick="showInfo(<%=htype[i].id%>,1)">
              <span class='glyphicon glyphicon-list' style='color:green;margin: 3px'  title ='Description'></span>
            </a>
            <a onclick="del(<%=htype[i].id%>)" type="button"><span class='glyphicon glyphicon-trash' style='color:red;margin: 3px'title='Delete'></span>
            </a>
          </td>
        </tr>
        <%}%>

      </tbody>
    </table>
</div>

</div>








<!-- Add Hardware starts-->
<div class="modal fade" id="editHardware" role="dialog" >
    <div class="modal-dialog"  style="margin-left: 150px">
      <!-- Modal content-->
      <div class="modal-content" id="express2" style ="width:1000px;height:auto;">
        <div class="modal-header" style="background-color:#f05f40;">
          <center><label id="head4" class="modal-title" style="color:white;"> Edit Hardware </label>
          <span id="dismiss"  data-dismiss="modal"  class="glyphicon glyphicon-remove" style='font-size:14pt;float:right;color:black;margin-bottom: 15px'></span>
          </center>
        </div>
        <div id="err" class="col-lg-6 col-sm-offset-3"></div>
          <div class="modal-body">
           <table class="table"><tr><td><td>
                <label class="form-Label" >Hardware Type: </label><sup class="astrick">*</sup></td>
             <td>
                <input type="text" id="type1"   name="type1"  class="form-text-box textBox" value="" disabled>
               <input type="hidden" id="type"   name="type"  class="form-control" value="" disabled>  
               <label id="ltype" class="form-Label labelans hide"></label>           
              </td></td><td><td>
                <label class="form-Label" >Quantity: </label><sup class="astrick">*</sup></td>
             <td>
                <input type="number" maxlength="2"  class="form-text-box textBox" id="qty" name="qty" onchange="addline()" />
                <label id="lqty" class="form-Label labelans hide"></label> 
              </td></td><td><td>
                <label class="form-Label">Vendor: </label><sup class="astrick">*</sup></td>
            <td> 
               <select  class="form-text-box textBox" style=""  name="vendor" id ="vendor" onchange=""> 
              <option value='0' disabled selected>Select</option>
               <% for(i=0;i<vendor.length;i++){%>
                <option value="<%=vendor[i].id%>"><%=vendor[i].name%></option>
                <%}%>
              </select>
              <label id="lvendor" class="form-Label labelans hide"></label> 

             </td></td></tr><tr><td><td>
                <label class="form-Label">Invoice Number: </label><sup class="astrick">*</sup>
              </td><td>
                <input type="text" maxlength="10"  class="form-text-box textBox" id="invoiceNo" name="invoiceNo" />
                <label id="linvoiceNo" class="form-Label labelans hide"></label>
                </td></td><td><td>

                <label class="form-Label">Invoice Date: </label><sup class="astrick">*</sup>
             </td><td>

                <input type="text" class="form-text-box date textBox" id="Invoicedate" name="Invoicedate" />
                   <label id="lInvoicedate" class="form-Label labelans hide"></label>
             </td></td><td><td>

                <label class="form-Label">Invoice Amount: </label><sup class="astrick">*</sup>
              </td><td>
                <input type="text" maxlength="11"  class="form-text-box textBox" id="invoiceAmt" name="invoiceAmt" />
                   <label id="linvoiceAmt" class="form-Label labelans hide"></label>
              </td></td></tr><tr><td><td>

                <label class="form-Label">Purchased Order: </label><sup class="astrick">*</sup>
             </td><td>
                <input type="text" maxlength="50"  class="form-text-box textBox" id="order" name="order" />
                   <label id="lorder" class="form-Label labelans hide"></label>
            </td></td><td><td>


             <input type="hidden" maxlength="50"   id="headerId"  /> 

                <label class="form-Label">Delivery Date: </label><sup class="astrick">*</sup>
           </td><td>
                <input type="text " class="form-text-box date textBox" id="Deliverydate"name="Deliverydate" />
                   <label id="lDeliverydate" class="form-Label labelans hide"></label>
            </td></td></tr></table>
            
             <div class="form-group">
             <div class=" col-md-12 table-responsive">
               <table id='table1' class="table table-striped table-bordered table-hover table-condensed hide"style="overflow:scroll;width:100%;">
                 <thead id="headi">
                 </thead>
                 <tbody id="bodyi">
                 </tbody>
               </table>
             </div>
             </div>
             </div>
            <div class="modal-footer"style="border-top:0px;">
              <center>
              <input type="text" class="hide" value="" id="hdnId" name="hdnId">
                <button id="cancel"type="reset"data-dismiss="modal" class="btn">Cancel</button>
                <input type="submit"    onclick="return validatehardvare()" class="btn hdwrbtn" value="Submit">
              </center>
            </div>
          </div>
        </div>
      </div>
  



    <!---->
    <div class="modal fade" id="editHardware1" role="dialog" >
    <div class="modal-dialog"  style="margin-left: 150px">
      <!-- Modal content-->
      <div class="modal-content" id="express2" style ="width:1000px;height:auto;">
        <div class="modal-header" style="background-color:#f05f40;">
          <center><label id="head4" class="modal-title" style="color:white;font-size:14pt;"><b>View Hardware</b></label>
          <span  data-dismiss="modal"  class="glyphicon glyphicon-remove" style='font-size:14pt;float:right;color:black;margin-bottom: 15px'></span>
          </center>
        </div>
        <div id="err" class="col-lg-6 col-sm-offset-3"></div>
          <div class="modal-body">
            <div class="col-md-12 a">
              <div class="col-md-2">
                <label style="line-height:42px !important;color:red; font-size: 12px">Hardware Type: </label>
              </div>
             <div class="col-md-2">
                <label id="t1" style="line-height:42px !important; font-size: 12px"></label>
              </div>
              <div class="col-md-2">
                <label style="line-height:42px !important;color:red; font-size: 12px">Quantity:</label>
              </div>
              <div class="col-md-2">
                <label id="t2" style="line-height:42px !important; font-size: 12px"></label>
              </div><div class="col-md-2">
                <label style="line-height:42px !important;color:red; font-size: 12px">Vendor:</label>
              </div><div class="col-md-2">
                <label id="t3" style="line-height:42px !important; font-size: 12px"></label>
              </div>
              <div class="col-md-12 a">
              <div class="col-md-2">
                <label style="line-height:42px !important; color:red;font-size: 12px">Invoice Amount:</label>
              </div>

              <div class="col-md-2">
                <label id="t4" style="line-height:42px !important; font-size: 12px"></label>
              </div>
          
             
             
              <div class="col-md-2">
                <label style="line-height:42px !important;color:red; font-size: 12px">Purchase Order: </label>
              </div>
             <div class="col-md-2">
                <label id="t5" style="line-height:42px !important; font-size: 12px"></label>
              </div>
              <div class="col-md-2">
                <label style="line-height:42px !important;color:red; font-size: 12px">Invoice Date:</label>
              </div>
              <div class="col-md-2">
                <label id="t6" style="line-height:42px !important; font-size: 12px"></label>
              </div>
              </div>
              <div class="col-md-12 a">
              <div class="col-md-2">
                <label style="line-height:42px !important;color:red; font-size: 12px">Invoice Number:</label>
              </div><div class="col-md-2">
                <label id="t7" style="line-height:42px !important; font-size: 12px"></label>
              </div><div class="col-md-2">
                <label style="line-height:42px !important; color:red;font-size: 12px">Delivery Date:</label>
              </div>
              <div class="col-md-2">
                <label id="t8" style="line-height:42px !important; font-size: 12px"></label>
              </div>
          
             </div>
             <div id='componentid'>
                <table id ='addComptable1' class="table table-striped table-bordered table-hover table-condensed" style="overflow-y:auto;">
            <col width="10"><col width="10"><col width="20"><col width="10"><col width="10">

                <thead id="modalHead">
                  <tr>
                    <th style="width:15%;">Component Name</th>
                    <th style="width:15%">Serial Number</th>
                    <th style="width:15%;">Brand</th>
                    <th style="width:15%">Warranty</th>
                    <th style="width:20%">Attribute</th>
                    <th style="width:20%">Attribute Value</th>
                  </tr>
                </thead>
                <tbody id="addcompobody1">
                </tbody>
              </table>
             </div>
             </div>
            <div class="modal-footer"style="border-top:0px;">
              <center>
                <button id="cancel"type="reset"data-dismiss="modal"class="btn btn-default" style="background-color:#f05f40;color:black;padding-top: 4px; width:100px;height:30px;margin-top:10px;color:white">Cancel</button>
              </center>
            </div>
          </div>
        </div>
      </div>
      </div>
   

    <!-- View More Details starts-->

<div class="modal fade" id="viewMore" role="dialog">
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content" id="express3">
        <div class="modal-header" style="background-color:#f05f40;">
          <center><label id="head4" class="modal-title" style="color:white;font-size:14pt;"><b>View More</b></label></center>
        </div>
        <div id="err" class="col-lg-6 col-sm-offset-3"></div>
          <div class="modal-body">
            <table class="table table-striped table-bordered table-hover table-condensed hide"style="overflow:scroll;width:100%;">
        <thead id="headi">
        </thead>
        <tbody id="bodyi">
        </tbody>
        </table>

            <div  class="modal-footer"style="border-top:0px;">
              <center>
              <input type="text" class="hide" value="" id="hdnId" name="hdnId">
                <button id="cancel"type="reset"data-dismiss="modal"class="btn btn-default" style="background-color:#f05f40;color:black;padding-top: 4px; width:100px;height:30px;margin-top:10px;color:white">Cancel</button>
                <input type="submit" onclick="return validatehardvare()"class="btn btn-default"style="margin-top:10px;background-color:#f05f40;color:black;padding-top:4px; width:100px;height:30px;color:white" value="Submit">
              </center>
            </div>
          </div>
        </div>
      </div>
    </div>

<div class="modal " id="addModal"  role="dialog">
  <div class="modal-dialog" style="display:table;">
    <!-- Modal content-->
    <div class="modal-content" id="express2" style="height:600px;width:800px">
      <div class="modal-header" style="background-color:#f05f40;">
        <center><label id="head4" class="modal-title" style="color:white; "> Add Component </label>
        <span  data-dismiss="modal"  class="glyphicon glyphicon-remove" style='font-size:14pt;float:right;color:black;margin-bottom: 15px'></span>
        </center>
      </div>
      <div id="err" class="col-lg-6 col-sm-offset-3"></div>
      <div class="modal-body">
        <div class="form-group">
          <div class=" col-md-12 table-responsive" id="addcompobody" style="margin-bottom: 20px;">
            <!--table class="table table-striped table-bordered table-hover table-condensed" style="overflow-y:auto;">
            <col width="10"><col width="10"><col width="20"><col width="10"><col width="10">

                <tbody id="addcompobody">
                </tbody>
              </table-->
             
            
             </div>
              <input type="hidden" id="serids"/>
              <div id="tablediv"></div>
                <input  data-dismiss="modal" type="button"class="btn btn-info" onclick="validatesubcomponent()" value="SUBMIT">
          </div>
        </div>
    </div>
  </div>
</div>

    <!-- Javascript function -->

</body>
<footer>
  <% include ../partials/footer %>

</footer> 

    <script>

   var col;
var comps=[];
var qty;
var attlength;
var allAttIds = [];
var allAttIds1 = [];
var arr=[];
var countAddCompModal=0;
  var fact=0;  
var idarray=[];

    




    $(document).ready(function(){
       $('.asset-img').addClass('active');
   var oTable=   $("#hardtable").dataTable({
        "bLengthChange": false,
        "binfo":false
      });
             $("#searchbox").keyup(function() {
        oTable.fnFilter(this.value);
      });
     var oTable1= $("#addComptable").dataTable({
        "bLengthChange": false,
        "binfo":false
      });
             $("#searchbox").keyup(function() {
        oTable1.fnFilter(this.value);
      });
      //getlinedtata();
    });

    jQuery('.date').datetimepicker({
      timepicker:false,
      format:'Y-m-d'
    });
    function validate(){
      var inamount=$('#invoiceAmt').val();
      var up=$('#uprice').val();
      if($('#vendor').val().length<1||$.trim($("#vendor").val()) =="") 
      {
      alert("Vendor is Missing!");    
      return false;
      }
    if($('#Invoicedate').val().length<1||$.trim($("#Invoicedate").val()) =="") 
    {
      alert("Invoice date is Missing!");    
      return false;
    }
     if($('#invoiceNo').val().length<1||$.trim($("#invoiceNo").val()) =="") 
    {
      alert("Invoice number is Missing!");    
      return false;
    }

    if(inamount.length<2||isNaN(inamount)||inamount.trim().length<1) 
    {
      alert("Enter valid Invoice Amount!");    
      return false;
    }
    if($('#qty').val().length<1||$.trim($("#qty").val()) ==""||$.trim($("#qty").val()) > 20) 
    {
      alert("Enter valid Quantity!");    
      return false;
    }
        
    if($('#Deliverydate').val().length<1||$.trim($("#Deliverydate").val()) =="") 
    {
      alert("Delivery date is Missing!");    
      return false;
    }

 
}

 i=0;
     function addCompModal(rowid){
      //alert('jai mata di addcompmodel');
      addId(rowid);
      kid=0;
      $('#addcompobody').html('');
      $('#tablediv').html('');
      
    var row = '<div class="row" id="tr'+countAddCompModal+''+i+'"><div class="col-md-3" style="padding-left:1px">Select Subcomponent :</div><div class="col-md-3"><select class = "form-text-box form-control" id="compo"><%for(var i=0;i<ctype.length;i++){%>';
    //if(('desktop' != "<%=ctype[i].id%>")&&('laptop' != "<%=ctype[i].id%>")){
        row+='<option value="<%=ctype[i].id%>"><%=ctype[i].componentName%></option>';
      //} 
    row+='<%}%></select></div><div class="col-md-2"><input type="button"class="btn btn-info addcompdata" onclick="addsubcomponent()" value="ADD"></div></div>';
   
         $('#addcompobody').append(row);
        // alert('jai ho');
         
         countAddCompModal++;
         i++

         var date=new Date($('#Deliverydate').val());
          jQuery('.datetimepicker').datetimepicker({
  timepicker:false,
  format:'Y-m-d', minDate:date
  });
     }

function saveId(id){
    addId(id);
    }

  var kid=0;  
function addsubcomponent() {
  kid++;
  var intr='<table class="table" style="overflow:scroll;width:100%;"><thead id="headij'+kid+'"></thead><tbody id="bodyk'+kid+'"></tbody></table>';
   $('#tablediv').append(intr);
    $('#tableQuantity').removeClass('hide');
    var typ = document.getElementById('compo');
    var selectedValue =typ.options[typ.selectedIndex].value;
    if (selectedValue == "0") {
        alert("Please select a type");
        console.log("intype");
        return false;
    }
    if ($('#qty').val().length < 1 || $.trim($("#qty").val()) < 1) {
        alert("Please enter valid Quantity!");
        return false;
    }
    qty = 1;
    if (qty > 20) {
        alert("Quantity cannot exceed 20!");
        document.getElementById('qty').value = '';
    } else {
        console.log(selectedValue);
        $.ajax({
            url: '/getAttr',
            method: 'post',
            data: {
                acid: selectedValue
            },
            dataType: 'json',
            success: function(result) {
                var head = '<tr style="height:12px"><th style="width:150px"># <span style="color:red" onclick="remove1('+kid+')" class="glyphicon glyphicon-remove-circle"></span></th><th >Component Name</th>';
                allAttIds = [];
                for (var i = 0; i < result[0].length; i++) {
                    console.log('head' + i)
                    head = head + '<th>' + result[0][i].attribute + '</th>';
                    allAttIds.push(result[0][i].attId);
                }
                allAttIds2 = allAttIds;
              
                /********************Important next line*************************/
                head = head + '<th >Brand</th><th style = "width:100px;" id ="underconsideration">Warranty Start Date</th><th style = "width:100px;" id ="underconsideration">Warranty End Date</th></tr>';
                $('#headij'.concat(kid)).append(head);
                //$('#bodyk').empty();
                arr.length = qty;
                col = result[0].length;
                attlength = col;

                for (var i = 0; i < qty; i++) {
                    var k = i
                    var row = '<tr><td>' + ++k + '<input type="hidden" class="form-text-box" id="rowlineid'+kid+'" value="0"></td><td><input type="hidden" class="form-text-box" id="attrid'+kid+'" value='+allAttIds.toString()+'><input type="hidden" class="form-text-box" id="col'+kid+'" value='+col+'><input type="hidden" class="form-text-box" id="sublineid'+kid+'" value=""><input type="hidden" class="form-text-box" placeholder="Enter serial number"' +
                        ' id="serial12' + kid + '" value='+selectedValue+'>'+$("#compo option:selected").text()+'</td>';
                    for (var o = 0; o < result[0].length; o++) {

                        row = row + '<td><select class="form-text-box" id="' + i + o +kid+ '"><option value="0">Select</option>';


                        for (var dropdownValues = 0; dropdownValues < result[1].length; dropdownValues++) {
                            if (result[0][o].attId == result[1][dropdownValues].attId) {
                                row = row + '<option value="' + result[1][dropdownValues].id + '">' + result[1][dropdownValues].value + '</option>';
                            }

                        }
                        row = row + '</select></td>';

                    }
                    row = row + '<td><select class="form-text-box" id="brands' + kid + '"><option value="0">Select</option>';

                    for (var dropdownValues = 0; dropdownValues < result[2].length; dropdownValues++) {
                        row = row + '<option value="' + result[2][dropdownValues].id + '">' + result[2][dropdownValues].value + '</option>';
                    }
                    row = row + '</select></td><td><input' + ' class="form-text-box datetimepicker2" id="warrantyco1' + kid + '" type = "text"></td>';
                    row = row + '</select></td><td><input' + ' class="form-text-box datetimepicker2" id="warrantyco2' + kid + '" type = "text"></td>';
                    row = row + '<td class="hide"><input' + ' class="single form-control warrClass" id="componen' + i + '" type = "hidden"></td>';
                
                    $('#bodyk'.concat(kid)).append(row);
                }
                  jQuery('.datetimepicker2').datetimepicker({
                    timepicker: false,
                    format: 'Y-m-d'
                });
}

});
}
}

  function remove1(tabid){
    var ids= $('#sublineid'.concat(tabid)).val();
      $.ajax({
        url:'/deletesubline',
        method:'post',
        async:true,
        data:{
            'ids':ids
             },
                dataType:'json',
                success:function(result){
             
                $('#headij'.concat(tabid)).addClass('hide');
                $('#bodyk'.concat(tabid)).addClass('hide');
                $('#rowlineid'.concat(tabid)).val(1);            
             }

           });
}

function addId(ids){
  $('#serids').val(ids);
 }

function del(id){ 
  //alert(id);
  if(confirm("This action once done cannot be undone! Do you want to delete this?")==true)
  {
  $.ajax({
    url:'/deleteHeaderandline',
    method: 'POST',
    data:{'id':id},
    success: function(data) {
     // window.location.reload();
     window.location.href='/viewHardware'
    },
    dataType: 'JSON',
  });
}
}

function description(id){
      $("#t1").html('');
      $("#t2").html('');
      $("#t3").html('');
      $("#t4").html('');
      $("#t5").html('');
      $("#t6").html('');
      $("#t7").html('');
      $("#t8").html('');
  //alert(id);
  $.ajax({ 
    url: '/getEditHardware',
    method:'POST',
    data: {'id':id},
    success: function(data) { 
      console.log("edit info----------------",data[0][0].componentName);
      $("#type").val(data[0][0].ACID);
      $("#t1").append(data[0][0].componentName);
      $("#t2").append(data[0][0].quantity);
      $("#t3").append(data[0][0].vendor);
      $("#t4").append(data[0][0].invoiceAmt);
      $("#t5").append(data[0][0].purchaseOrder);
      $("#t6").append(((data[0][0].invoiceDate).toString()).slice(0,11));
      $("#t7").append(data[0][0].invoiceNo);
      $("#t8").append(((data[0][0].deliveryDate).toString()).slice(0,11));
      //$("#hdnId").val(data[0][0].id);
      //getlinedtata();
      //getlineValue(id);
      getidfordescription(id);
    }
  });
}

function showInfo(id,flag){
  if(flag){                                                               //view details
  $(".labelans").removeClass("hide");
  $(".textBox").addClass("hide");
  $(".chnBtn").val("View");
  $("#head4").html("View Hardware");
  $(".hdwrbtn").addClass("hide");

  $(".lineText").attr('disabled',true); 
  $(".lineText").attr('disabled','disabled');
  document.getElementsByClassName("lineText").disabled = true;
}
else{                                                                 //Edit Details
  $(".labelans").addClass("hide");
  $(".textBox").removeClass("hide");
  $(".chnBtn").val("Edit")
  $("#head4").html("Edit Hardware");
  $(".hdwrbtn").removeClass("hide");

  $(".lineText").attr('disabled',false); 
  $(".lineText").removeAttr("disabled");
  document.getElementsByClassName("lineText").disabled = false; 
}

  $("#hdnId").val('');
  //alert(id);
  $.ajax({ 
    url: '/getEditHardware',
    method:'POST',
    data: {'id':id},
    success: function(data) { 
      console.log("edit info----------------",data[0]);
      $("#type").val(data[0][0].ACID);
      $("#type1").val(data[0][0].componentName);
      $("#qty").val(data[0][0].quantity);
      $("#vendor").val(data[0][0].vendor);
      $("#invoiceAmt").val(data[0][0].invoiceAmt);
      $("#order").val(data[0][0].purchaseOrder);
      $("#Invoicedate").val(data[0][0].invoiceDate);
      $("#invoiceNo").val(data[0][0].invoiceNo);
      $("#Deliverydate").val(data[0][0].deliveryDate);
      $("#hdnId").val(data[0][0].id);

    
      $("#ltype").html(data[0][0].componentName);
      $("#lqty").html(data[0][0].quantity);
      $("#lvendor").html(data[0][0].vendor);
      $("#linvoiceAmt").html(data[0][0].invoiceAmt);
      $("#lorder").html(data[0][0].purchaseOrder);
      $("#lInvoicedate").html(data[0][0].invoiceDate);
      $("#linvoiceNo").html(data[0][0].invoiceNo);
      $("#lDeliverydate").html(data[0][0].deliveryDate);

      getlinedtata();
      getlineValue(id);
    }
  });
}

function addline(){
 var id=$("#hdnId").val();
  getlinedtata();
  getlineValue(id);
}

function getlinedtata(){
      $('#tableQuantity').removeClass('hide');
   // var typ = document.getElementById('typel');
    var selectedValue = $("#type").val();
    if (selectedValue == "0") {
        alert("Please select a type");
        console.log("intype");
        return false;
    }
    if ($('#qty').val().length < 1 || $.trim($("#qty").val()) < 1) {
        alert("Please enter valid Quantity!");
        return false;
    }
   
    qty = document.getElementById('qty').value;

    if (qty > 20) {
        alert("Quantity cannot exceed 20!");
        document.getElementById('qty').value = '';
    } else {
        console.log(selectedValue);
        $.ajax({
            url: '/getAttr',
            method: 'post',
            data: {
                acid: selectedValue
            },
            dataType: 'json',
            success: function(result) {

                $('#headi').empty();
                var head = '<tr ><th>#</th><th >Serial No.</th>';
                allAttIds = [];
                for (var i = 0; i < result[0].length; i++) {
                    console.log('head' + i)
                    head = head + '<th>' + result[0][i].attribute + '</th>';
                    allAttIds.push(result[0][i].attId);
                }
                allAttIds1 = allAttIds;
              
              
                head = head + '<th >Brand</th><th style = "width:100px;" id ="underconsideration">Warranty Start Date</th><th style = "width:100px;" id ="underconsideration">Warranty End Date</th><th "width:100px;"  class = "">Components</th></tr>';
                $('#headi').append(head);
                $('#bodyi').empty();
                arr.length = qty;
                col = result[0].length;
                attlength = col;
                for (var i = 0; i < qty; i++) {
                    var k = i
                    var row = '<tr><td>' + ++k + '</td><td><input class="form-text-box" placeholder="Enter serial number"' +
                        ' id="serial' + i + '"></td>';
                    for (var o = 0; o < result[0].length; o++) {

                        row = row + '<td><select class="form-text-box" id="' + i + o + '"><option value="0">Select</option>';


                        for (var dropdownValues = 0; dropdownValues < result[1].length; dropdownValues++) {
                            if (result[0][o].attId == result[1][dropdownValues].attId) {
                                row = row + '<option value="' + result[1][dropdownValues].id + '">' + result[1][dropdownValues].value + '</option>';
                            }

                        }
                        row = row + '</select></td>';

                    }

                   


                    row = row + '<td><select class="form-text-box" id="brand' + i + '"><option value="0">Select</option>';

                    for (var dropdownValues = 0; dropdownValues < result[2].length; dropdownValues++) {
                        row = row + '<option value="' + result[2][dropdownValues].id + '">' + result[2][dropdownValues].value + '</option>';
                    }
                    row = row + '</select></td><td><input' + ' class="form-text-box datetimepicker1" placeholder="Start Date" id="warranty' + i + '" type = "text"></td><td><input' + ' class="form-text-box datetimepicker1" placeholder="End Date" id="warranty1' + i + '" type = "text"></td>';
                    row = row + '<td class="hide"><input' + ' class="single form-control warrClass" id="componentdata' + i + '" type = "hidden"></td>';
                     row = row + '<td class="hide"><input class="single form-text-box warrClass lineText" id="id'+i+'" type = "hidden" value="0"></td>';


                    row = row + '<td class = "">' + '<input onclick="getsubline('+i+')" class="btn btn-danger"type="button"data-toggle="modal"' + ' value="Add"data-target="#addModal"' + 'style="background-color:#f05f40;color:white;" id="' + i + '"' + ' onclick="saveId(' + i + ')">' + '</td></tr>';
                  
                   // addId(i);
                    $('#bodyi').append(row);
                }


                jQuery('.datetimepicker1').datetimepicker({
                    timepicker: false,
                    format: 'Y-m-d'
                });


                $('table').removeClass('hide');
                arr[i] = {
                    specification: null,
                    brand: null,
                    serial: null,
                    warranty: null,
                    component: {},
                    saved: false
                };

            }


        });
    }
  }

  function sleepFunctionForStoppingTime(miliseconds) {
   var currentTime = new Date().getTime();

   while (currentTime + miliseconds >= new Date().getTime()) {
   }
}

    function getlineValue(id){
   $.ajax({
        url:'/getlineid',
        method:'post',
        async:true,
        data:{
            'id':id
             },
                dataType:'json',
                success:function(result){

                 var lineid=[];
                 lineid=result[0][0].ids.split(',');
                 sleepFunctionForStoppingTime(200);
               for(var i=0;i<lineid.length;i++){
               // alert(lineid[i]);
              getattrline(lineid[i],i);
             }
          }

});
}


 function getidfordescription(id){
 $('#addcompobody1').html(' ');
   $.ajax({
        url:'/getlineid',
        method:'post',
        async:true,
        data:{
            'id':id
             },
                dataType:'json',
                success:function(result){
                 var lineid=[];
                 lineid=result[0][0].ids.split(',');
               for(var i=0;i<lineid.length;i++){
              getcomponentfordescription(lineid[i]);
             }
                                      }

});
}

  function getattrline(id,nu)
  {

   $.ajax({
        url:'/getlinevalue',
        method:'post',
        async:true,
        data:{
            'id':id
             },
                dataType:'json',
                success:function(result)
                {
                  //getsubline(result[0][0].Id);
                  $('#id'.concat(nu)).val(id);
                  $('#serial'.concat(nu)).val(result[0][0].serialNo);
                  $('#brand'.concat(nu)).val(result[0][0].id);
                  $('#warranty'.concat(nu)).val(result[0][0].warrantyStart);
                   $('#warranty1'.concat(nu)).val(result[0][0].warrantyEnd);
                  for(var j=0;j<result[2].length;j++)
                  {
                      $('#'.concat(nu).concat(j)).val(result[2][j].id);
                  
                  }
               }

         });
  }



 function getsubline(k)
 {
 
  addCompModal(k);
  //$("#addComptable").dataTable().fnDestroy();
  //$('#addcompobody').empty();
 // countAddCompModal=0;
 var str1='';
  var id=$('#id'.concat(k)).val();
 //alert(k);
   $.ajax({
        url:'/getsublinevalue',
        method:'post',
        async:true,
        data:{
            'id':id
             },
                dataType:'json',
                success:function(result)
                { saveId(k);
                 for(var i=0; i<result[0].length;i++)
                   { 
                    var l=i+1;//sleepFunctionForStoppingTime(100)
                    (function(i){

                      window.setTimeout(function(){ 
                      $('#compo').val(result[0][i].ACID);
                       $('.addcompdata').click();                     
                        getsublinevalue(k,l);
                        }, i * 500);

                   }(i));
                    
                   }
                   getsublinevalue(k,l);
                   $('#componentdata'.concat(k)).val(str1);
                    
                      //alert(str1);
                }

          });
      
}


function getsublinevalue(k,l)
 {
 var str1='';
  var id=$('#id'.concat(k)).val();
 //alert(id);
   $.ajax({
        url:'/getsublinevalue',
        method:'post',
        async:true,
        data:{
            'id':id
             },
                dataType:'json',
                success:function(result)
                {
                 for(var i=0; i<result[0].length;i++)
                   { 

                  var zid=i+1;
                      $('#brands'.concat(zid)).val(result[0][i].brand);
                      $('#warrantyco1'.concat(zid)).val(result[0][i].warrantyStart);
                      $('#warrantyco2'.concat(zid)).val(result[0][i].warrantyEnd);
                      $('#sublineid'.concat(zid)).val(result[0][i].id);
                       for(var j=1;j<result.length;j++)
                      {
                       for(var k=0;k<result[j].length;k++){
                      $('#0'.concat(k).concat(j)).val(result[j][k].id);
                    }
                  
                  }
                   }
                  
                }

          });
}


 function getcomponentfordescription(id)
 {
 
 
   $.ajax({
        url:'/getcomponentfordescription',
        method:'post',
        async:true,
        data:{
            'id':id
             },
                dataType:'json',
                success:function(result)
                {  
                   var di='';
                    var  atter='';
                     var value='';
                   for(var j=0;j<result[2].length;j++){
                    
                    atter=atter+result[2][j].attribute+',';
                    value=value+result[3][j].value+',';
                    }
                   di=di+'<tr><td>'+result[0][0].componentName+'</td><td>'+result[0][0].serialNo+'</td><td>'+result[0][0].name+'</td><td>'+result[0][0].warranty+'</td><td>'+atter+'</td><td>'+value+'</td></tr>';
                   $('#addcompobody1').append(di);   
                }

          });
}


function validatehardvare(){
  if($('#vendor').val().length<1||$.trim($("#vendor").val()) =="") 
  {
    alert("Vendor is Missing!");    
    return false;
  }

  else if($('#invoiceNo').val().length<1||$.trim($("#invoiceNo").val()) =="") 
  {
    alert("Invoice No Missing!");    
    return false;
  }

  else if($('#Invoicedate').val().length<1||$.trim($("#Invoicedate").val()) =="") 
  {
    alert("Invoice date Missing!");    
    return false;
  }

  else if($('#invoiceAmt').val().length<1||$.trim($("#invoiceAmt").val()) =="") 
  {
    alert("Invoice Amount Missing!");    
    return false;
  }

  else if($('#order').val().length<1||$.trim($("#order").val()) =="") 
  {
    alert("Placed order Missing!");    
    return false;
  }

  else if($('#Deliverydate').val().length<1||$.trim($("#Deliverydate").val()) =="") 
  {
    alert("Delivery date Missing!");    
    return false;
  }
  else if(new Date($('#Deliverydate').val())<new Date($('#Invoicedate').val())){
    alert("Delivery date cannot be less then invoice date!");
     return false;
  }

  else
    for(var i=0;i<document.getElementById('qty').value;i++){
    if($('#serial'.concat(i)).val()==''){
      alert('Serial Number Missing!');
      return false;
    }
    else if($('#warranty'.concat(i)).val()==''){
      alert('Warranty Missing!');
      return false;
    }

    else if(new Date($('#warranty'.concat(i)).val())<new Date($('#Deliverydate').val())  ){
      j=i+1;
      alert("Warranty date at row "+j+" cannot be less then Delivery date!");
      return false;
    }
    var abc=0;
    for(var j=0;j<document.getElementById('qty').value;j++){
      if(i != j){
        if($('#serial'.concat(i)).val() == $('#serial'.concat(j)).val()){ abc++; }
      }
    }

    if(abc!=0){
      alert('Serial number of two components cannot be same.');
      return false;
    }


    else if(i==((document.getElementById('qty').value)-1)){
     parsealldata(); 
    }
  }
  
}

function validatesubcomponent(){
         for(var  i=1;i<=kid;i++){
  if($('#rowlineid'.concat(i)).val()==0){
    if($('#brands'.concat(i)).val()==0){
        alert('Please select Brand');
        return false;
       }
      else if($('#warrantyco1'.concat(i)).val()==0){
             alert('Please fill Warranty start date');
             return false;
        }
         else if($('#warrantyco2'.concat(i)).val()==0){
                alert('Please fill warranty end date');
                return false;
           }
            else{
                   var stratt='';
                   var len1=$('#col'.concat(i)).val();
                   for(var j=0;j<len1;j++){
                   if($(('#0'.concat(j)).concat(i)).val()==0){
                    alert('Please select attribute value');
                    return false;
                  }
                  else{
                    saveComp();
                  }
     };
    } 
} 
}
}



         function saveComp(){
     tempArr='';
     var str='';
   
  for(var  i=1;i<=kid;i++){
    if($('#rowlineid'.concat(i)).val()==0){
    var stratt='';
    var len1=$('#col'.concat(i)).val();
    for(var j=0;j<len1;j++){
     stratt=stratt+$(('#0'.concat(j)).concat(i)).val();
    }
  
   str= str+$('#serial12'.concat(i)).val()+'/'+$('#brands'.concat(i)).val()+'/'+$('#warrantyco1'.concat(i)).val()+'/'+$('#warrantyco2'.concat(i)).val()+'/'+stratt+'/'+$('#attrid'.concat(i)).val()+'/'+$('#sublineid'.concat(i)).val();
   tempArr=tempArr+str;
   str='?'; 
   } 
   }
   //alert(tempArr);
   $('#componentdata'.concat($('#serids').val())).val(tempArr);
 

  }


       function parsealldata(){
    var q=$('#qty').val();
    var str2='';
    var str1='';
    dataArray=[];
   
    for(var i=0;i<q;i++){
      for(var j=0;j<allAttIds1.length;j++){
   str2=str2+$('#'.concat(i).concat(j)).val()+',';}
   str1=str2+'$';
   str2='';
   dataArray[i]=str1;
   //str1='$';
    }
   // alert(dataArray);
    addHardware(dataArray);
  }


  function addtag(ides){
var  tagNo='PSSL'+ides;
   $.ajax({
        url:'/updateTag',
        method:'post',
        async:true,
        data:{
            'tagNo' : tagNo,
             'ides':ides
             },
                dataType:'json',
                success:function(result){
                 
             alert('data add successfully ');
            //($("#editHardware").modal()).close();
            $('#dismiss').click();
                                      }

});
}

/*******update hardware**********/


  function addlinedata(t1,t2,t3,t6,t7,headid,ctypeid,arr1,t8,ide){
   var arr3=[];
   arr3=arr1.split('?');
   alert(arr3);
    var arr2=[];

   $.ajax({
        url:'/addline',
        method:'post',
        data:{
            't1' : t1,
            't2': t2,
            't3' : t3,
             't6' : t6,
             't7' : t7,
             'hdId' : headid,
             'ctype':ctypeid,
             'ides' :ide,
             't8' : t8

             },
                dataType:'json',
                success:function(result){
                    for(var i=0;i<arr3.length;i++){
                       var   increment= arr3.length-1;
                       var  inc=i;
                      arr2=arr3[i].split('/');
                      if(arr2[0]!=''){
                      alert(arr2[6]);  
               addsubline(arr2[0],arr2[1],arr2[2],arr2[3],arr2[4],arr2[5],arr2[6],headid,ctypeid,result,increment,inc);
                   }
                   else{
                    if(fact==($('#qty').val())){
                    alert('Hardware update successfully.');    window.location.href='/viewHardware';}
                   }
                     }
                   }
             
             

});
}
 var t=0;
function addsubline(st1,st2,st3,st4,st5,st6,ides,headerid,ctypeid,lineid,incr,inc1){
   $.ajax({
        url:'/subaddline',
        method:'post',
        data:{
            'st1' : st1,
            'st2': st2,
            'st3' :st3,
            'st4' : st4,
            'st5'  : st5,
            'st6':st6,
             'hdId' : headerid,
             'ctype':ctypeid,
             'lineid':lineid,
             'ides':ides
             },
                dataType:'json',
                success:function(result){
                  if((fact==$('#qty').val())&&(incr==inc1)){
                   t++;
                if(t==fact){
               alert('Update data successfully');
               window.location.href='/viewHardware';
                  }
                  }
                
             
              }

});
}
function addHardware(newOuterArr){
 //document.getElementById("submit").disabled = true;
 var array=[];
 var newarray=[];
 var compdata=[];
 var linedata=[];
 var sublinedata=[];
  var len=$('#qty').val();

   $.ajax({
        url:'/addHardware',
        method:'post',
       
        data:{
            'attr':newOuterArr,
            'type' : $('#type').val(),
        'invoiceNo': $('#invoiceNo').val(),
  'purchasedOrder' : $('#order').val(),
        'Quantity' : $('#qty').val(),
    'invoiceDate'  : $('#Invoicedate').val(),
    'deliveryDate' : $('#Deliverydate').val(),
    'vendor'       : $('#vendor').val(),
    'invoiceAmt'   : $('#invoiceAmt').val(),
          'ides'   : $("#hdnId").val()
             },
                dataType:'json',
                success:function(result){
                 for(var i=0;i<len;i++){
                fact++;
                array=newOuterArr[i].split("$");
                 var attid= allAttIds1.toString();
          addlinedata($('#serial'.concat(i)).val(),attid,array[0],$('#brand'.concat(i)).val(),$('#warranty'.concat(i)).val(),result,$('#type').val(),$('#componentdata'.concat(i)).val(),$('#warranty1'.concat(i)).val(),$('#id'.concat(i)).val());        
     }
  }

});
}
 /* function addlinedata(t1,t2,t3,t6,t7,headid,ctypeid,arr1,ide){
    
   var arr3=[];
   arr3=arr1.split('?');
   //alert(arr3.length);
    var arr2=[];

   $.ajax({
        url:'/addline',
        method:'post',
        async:true,
        data:{
            't1' : t1,
            't2': t2,
            't3' : t3,
             't6' : t6,
             't7' : t7,
             'hdId' : headid,
             'ctype':ctypeid,
             'ides':ide

             },
                dataType:'json',
                success:function(result){
                    for(var i=0;i<arr3.length;i++){
                      var arrayforsucess=arr3.length;
                       var increment=arr3.length-1;
                       var n=i;
                      arr2=arr3[i].split(',');
                       if(arrayforsucess!=0){
                     
               addsubline(arr2[0],arr2[1],arr2[2],arr2[3],arr2[4],headid,ctypeid,result,arr2[5],increment,n);}
                else{
                    if(fact==($('#qty').val())){
                    alert('update data successfully');}
                   }
                     }
             
             }

});
}
function addsubline(st1,st2,st3,st4,st5,headerid,ctypeid,lineid,ides,lni1,n1){
   $.ajax({
        url:'/subaddline',
        method:'post',
        async:true,
        data:{
            'st1' : st1,
            'st2': st2,
            'st3' :st3,
            'st4' : st4,
            'st5'  : st5,
             'hdId' : headerid,
             'ctype':ctypeid,
             'lineid':lineid,
             'ides':ides
             },
                dataType:'json',
                success:function(result){
                  if((fact==$('#qty').val())&&(lni1==n1)){
                 t++;
                
                 if(t==fact){
             alert('data update successfully ');
              $('#dismiss').click();
           }
           }
                                      }

});
}*/


/*function addHardware(newOuterArr){
 // allAttIds = allAttIds.join(',');
  t=0;
 var array=[];
 var newarray=[];
 var compdata=[];
 var linedata=[];
 var sublinedata=[];
  var len=$('#qty').val();


   $.ajax({
        url:'/addHardware',
        method:'post',
        async:true,
        data:{
            'attr':newOuterArr,
            'type' : $('#type').val(),
        'invoiceNo': $('#invoiceNo').val(),
  'purchasedOrder' : $('#order').val(),
        'Quantity' : $('#qty').val(),
    'invoiceDate'  : $('#Invoicedate').val(),
    'deliveryDate' : $('#Deliverydate').val(),
    'vendor'       : $('#vendor').val(),
    'invoiceAmt'   : $('#invoiceAmt').val(),
    'ides': $("#hdnId").val()
             },
                dataType:'json',
                success:function(result){
                 for(var i=0;i<len;i++){
                   fact++;
 array=newOuterArr[i].split("$");
 var attid= allAttIds1.toString();

          addlinedata($('#serial'.concat(i)).val(),attid,array[0],$('#brand'.concat(i)).val(),$('#warranty'.concat(i)).val(),result,$('#type').val(),$('#componentdata'.concat(i)).val(),$('#id'.concat(i)).val());

             
                                      }
                                      }

});
}*/
/*********end***********/

</script>