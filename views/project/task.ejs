<head> 
<!--     $('.se-pre-con').fadeIn('slow');  -->
    <% include ../partials/head %>
  
    <% include ../partials/adminheader %>

    <% include header %>

</head>
<title>task manaagement</title>
<% 


/******************Mayur pls remove**********************
var ultimateEndId  = 1000;
var prId = 1;
var projectDetails = [{
                'id' :1,
      'projectTitle' :'Time1' }];
/******************Mayur pls remove**********************/
  var newVersionToBeCreated  = verArr.length + 1; 

var marginleftarr = [];
    marginleftarr[1] = 43;
    marginleftarr[2] = marginleftarr[1] + 19;
    marginleftarr[3] = marginleftarr[2] + 19;
    var treeStructure = [];
    var Tree = '';
    var startCounterTreeComponent;
    //console.log('ultimateEndId is ',ultimateEndId);
    //console.log('tc',treeComponent);
  for(var i = 0 ;(i<=ultimateEndId)&&(ultimateEndId!=0);i++){   //here i is table id 
   treeStructure.push([]);

for(var  k = 0 ; k < treeComponent.length; k++){  //here k is index number from array
  if(treeComponent[k].parentId == i){
   treeStructure[i].push(treeComponent[k].id);
      startCounterTreeComponent = k ;
  }
}


}

var newvar = treeStructure;
var submitted  = 0;
var effortArr = ['','Hrs','Days','Weeks','Months','Years'];
var Foldernames = [];
if(!treeComponent.length){
  submitted  = 0;
}

else{
         submitted = treeComponent[0].isSubmit;
    }
for(var i = 0 ;i<treeComponent.length;i++){
var resourceName = '';
for(var j = 0;j<Resources.length;j++){
if(Resources[j].id == treeComponent[i].resources){
resourceName = Resources[j].firstName+' '+Resources[j].lastName;
}

}

  var newobj =  { 'name' :  treeComponent[i].name,
               'sdate':  treeComponent[i].startDate,
               'edate': treeComponent[i].endDate,
              'effort':treeComponent[i].effort,
          'effortType':effortArr[treeComponent[i].effortType],
          'perc'      : treeComponent[i].percCompleted + ' %',
                 'resc'      : resourceName
                };
   Foldernames[treeComponent[i].id] = newobj;
}

var optionStr = '<select class = " ddResources"><option value = "0"> --Select </option>';
for(var i = 0;i<Resources.length;i++){

optionStr = optionStr +'<option value ="'+Resources[i].id+'" >'+Resources[i].firstName+' '+Resources[i].lastName+'</option>';
}
optionStr = optionStr + '</select>';
//console.log(optionStr);


createTree(treeStructure,0,-1);

var hideAddButtonClass = '';

function createTree(idarr,num,level){
      //console.log('loop',num,level);
      var level1 = level + 1;
       
for(var i=0;i<idarr[num].length;i++){
    //console.log('size',idarr[num].length,'inc',i);
    if(level==-1){
      if(!treeStructure[idarr[num][i]].length){
         hideAddButtonClass = ' deleteCSS ';
       
      }

    else {
            hideAddButtonClass = '';
            
         }


                      
         Tree = Tree + '<tr id = '+idarr[num][i]+'_rowid_'+num+' ><td></td><td class="phase bold1"><img src="../img/project/minus.png" id = '+idarr[num][i]+'_sign_'+num+' onclick = "collapseExpand(this.id,1)" class="minus '+hideAddButtonClass+'" height="18px" title="Add Phase" width="18px" style="margin-right:5px;">'+Foldernames[idarr[num][i]].name+'</td><td class="images1 bold1"><img src="../img/bug/addbug.png" id = '+idarr[num][i]+'_add_'+num+'  class="shadow phaseImg  " onclick = "addRow(this.id)" height="18px" title="Add Phase" width="18px"></td><td class="images1 bold1"><img src="../img/write.png" onclick = "editRow(this.id,0)" id = '+idarr[num][i]+'_edit_'+num+'    height="22px" class="shadow editRowClass" title="Add Phase" width="22px"></td><td class="dateCSS bold1">'+Foldernames[idarr[num][i]].sdate+'</td><td class="dateCSS bold1">'+Foldernames[idarr[num][i]].edate+'</td><td class="effCSS bold1">'+Foldernames[idarr[num][i]].effort+' '+Foldernames[idarr[num][i]].effortType+'</td><td class = "bold1">'+Foldernames[idarr[num][i]].perc+'</td><td></td><td>'+Foldernames[idarr[num][i]].resc+'</td></tr>';
       }

 else if(level==0){

    if(!treeStructure[idarr[num][i]].length){
         hideAddButtonClass = ' deleteCSS ';
      
       
      }

    else {
            hideAddButtonClass = '';
            
         }
         
 Tree = Tree + '<tr id = '+idarr[num][i]+'_rowid_'+num+' ><td></td><td class="task"><img src="../img/project/plus.png" class="plus'+hideAddButtonClass+'" onclick = "collapseExpand(this.id,1)"  id = '+idarr[num][i]+'_sign_'+num+' height="18px" title="" width="18px" style="margin-right:5px;">'+Foldernames[idarr[num][i]].name+'</td><td class="images1 bold1"><img src="../img/bug/addbug.png" class="shadow " height="18px" onclick = "addRow(this.id)"  id = '+idarr[num][i]+'_add_'+num+' title="Add Child" width="18px"></td><td class="images1 bold1"><img src="../img/write.png" onclick = "editRow(this.id,0)" id = '+idarr[num][i]+'_edit_'+num+' height="22px" class="shadow editRowClass" title="Add Child" width="22px"></td><td class="dateCSS ">'+Foldernames[idarr[num][i]].sdate+'</td><td class="dateCSS">'+Foldernames[idarr[num][i]].edate+'</td><td class="effCSS">'+Foldernames[idarr[num][i]].effort+' '+Foldernames[idarr[num][i]].effortType+'</td><td>'+Foldernames[idarr[num][i]].perc+'</td><td></td><td>'+Foldernames[idarr[num][i]].resc+'</td></tr>';
     

      } 




      else if(level==1){
        console.log('in level 1');
  Tree = Tree + '<tr id = '+idarr[num][i]+'_rowid_'+num+' class = "hide"><td></td><td class="subtask"><img src="../img/project/button.png" class="shadow donthide" height="18px" title="" width="18px" style="margin-right:5px;">'+Foldernames[idarr[num][i]].name+'</td><td class="images1 bold1 "></td><td class="images1 bold1"><img src="../img/write.png" onclick = "editRow(this.id,0)" id = '+idarr[num][i]+'_edit_'+num+'  height="22px" class="shadow editRowClass" title="Add Child" width="22px"></td><td class="dateCSS ">'+Foldernames[idarr[num][i]].sdate+'</td><td class="dateCSS ">'+Foldernames[idarr[num][i]].edate+'</td><td class="effCSS ">'+Foldernames[idarr[num][i]].effort+' '+Foldernames[idarr[num][i]].effortType+'</td><td>'+Foldernames[idarr[num][i]].perc+'</td><td></td><td>'+Foldernames[idarr[num][i]].resc+'</td></tr>';
      }

else{
    console.log('Error!!!!',i,num,idarr[num]);
      }


  if(level<1){
  createTree(idarr,idarr[num][i],level1);
   }

}
//console.log('return',num);
return ;


}


 var newno = parseInt(version) + 1;

var presentIdsArr = [];
for(var i = 0 ;i<treeComponent.length;i++){
presentIdsArr.push(treeComponent[i].id);
}


%>

<html>
<body style="overflow-x:none ">
<div class="se-pre-con"></div>


<div class="row" style="margin-left: 0px;padding-left: 2%;margin-right: 0px;padding-bottom: 2%;overflow:none ">
  <div  style="padding-top: 17px;padding-bottom: 4px;width: 122%" class = 'col-md-12' >
  <!--  <label>Select Project</label> -->

   <div class = 'col-md-2 hide' style = 'width:15%;margin-left: -2%;'>
   Created By:<b style = 'margin-left:4%'>Mayur</b>       
    </div>


  <div class = 'col-md-2' style = 'width: 11%;'>
      Status : <b id = 'statusSub'>Draft</b>       
    </div>
    <div class = 'col-md-1'>
    <span>Project :</span>
  </div>
      <div class = 'col-md-3' style = ' margin-left: -3%;'>

    <select class="form-control" style="width: 300px;margin-top: -2%;" id ='proSel'>
      <%for(var i = 0;i<projectDetails.length;i++){%>
      <option value = '<%=projectDetails[i].id%>'><%=projectDetails[i].projectTitle%></option>
      <%}%>
    </select>
    </div>

<!--- Dev Code-->
 
 <div class = 'col-md-1'>
    <span style = 'margin-left:14%;'>Version :</span>
  </div>
      <div class = 'col-md-1' style = ' margin-left: -2%;'>

    <select class="form-control" style="width: 90px;margin-top: -10%;" id ='verSel'>
        <%for(var i = 0;i<verArr.length;i++){%>
      <option value = '<%=verArr[i]%>'><%=verArr[i]%></option>
      <%}%>
   
    </select>
    </div>

<!-- Dev Code-->





    <div class = 'col-md-2 ' style ='margin-left: 2%;width:15%;' >Start Date :<b><%=prStartDate%></b> </div>
    <div class = 'col-md-2' style = 'width: 14%;margin-left: -2%;'>End Date :<b><%=prEndDate%></b></div>

  </div>
  <div class="col-md-12" id="taskBox" style="/*height: 440px;max-height:440px;*/margin-top: 5px;margin-right: 1%;border: #f05f40 solid;background-color: white;padding-bottom: 2%;">
    
    <div class="addTask" style = 'position: relative;overflow-x: scroll;'>
  
        <table border = '3' style = "width:134%" id = "projTable">
             <col width="40">
                       <col width="10">
                       <col width="10">
                       <col width="15">
                       <col width="15">
                       <col width="5">
                       <col width="5">
          <thead>
            <tr id = '0_rowid_-1'>
            <th style = "width:4%">#</th>
            <th style = "width:35%">Name</th><th style = "width:5%"><img src="../img/bug/addbug.png" class="shadow" id = '0_add_-1' onclick="addRow(this.id)" height="18px" title="Add Phase" width="18px"><div style = 'font-size:8px;'>Add Phase</div></th><th style = "width:5%">Delete</th><th style = "width:9%">Start</th><th style = "width:9%">End</th><th style = "width:9%">Effort</th>
            <th style = "width:3%"> % Completed</th>
            <th style = "width:9%">Dependencies</th>
            <th style = "width:9%">Resources</th>
          </tr>
          </thead>
          <tbody id = 'tbody123'>
         </tbody>          
        </table>
       
      </div>
    <div>
    </div>   
  </div>
  <!--  <div style = ''> -->
   <button type="button" class="btn btn-success" id = 'saveId' style=" margin-bottom: -6%;height: 30px;background-color: #f05f40;border-color: #f05f40;margin-top:1%;margin-left:85%;" onclick="savethis(0,1)">Save</button>
    <button type="button" class="btn btn-success"  id = 'submitId'  style=" margin-bottom: -1%;height: 30px;background-color: #f05f40;border-color: #f05f40;margin-top:1%;margin-left:91%;" onclick="savethis(1,1)">Submit</button>
<!--     <div>
 --></body>
</div>

    
 <% include ../partials/footer %> 
 

   <!------------------------------editTask/addSubTask---------------------------->
        <div class="modal fade" id="rejectModal" style="height:auto">
            <div class="modal-dialog">
                <!-- Modal content-->
                <div class="modal-content" id="express2">
                    <div class="modal-header" style="background-color:#f05f40;height:40px">
                       <center>
                   <h4 id="taskModalHeading" class="modal-title" style="color:white;font-size:14pt;margin-top: -8px">Reason for Rejection</h4>
                              <project/button type="project/button" class="close" data-dismiss="modal" style="float:right;margin-top: -28px">&times;</project/button>
                             </center>
                    </div>
                <div class="modal-body" id="iremarkdiv" style="margin:10px;height: 110px">
        <textarea style="float:left;width:100%;height:123%;width:102%" id="eDiscription"  maxlength="10000" class='form-control description'></textarea>
       </div>
     <div class = 'modal-footer'>
   <button type="button" class="btn"  onclick = 'approvethis(0,1)' style="" data-dismiss = 'modal'>Submit</button>
    <button type="button" class="btn"  style="" data-dismiss = 'modal'>Cancel</button>
                            </div>
                       </div>
                         
                      </div>
                </div>
            </div>
        </div>


    <link  type="text/css"   href = '/stylesheets1/stylesheets/proj_css.css' rel="stylesheet" >
   <% include ../project/proj_mngmt_script.ejs %>

        </html>