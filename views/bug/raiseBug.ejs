
<!DOCTYPE html>
<html lang="en">
<% include ../partials/head %>
<% include header.ejs %>
 <% include ../partials/adminheader %>
    <title>Raise Bug</title>

    <head>
 
        <script>
/*$(function() {
    $( "#tentativeclouser" ).datepicker({ minDate: 0});
  });
  */
        function validateForm() {
            var titlebox = document.forms["rbug"]["titlebox"].value;
            var editorContent = tinyMCE.get('description').getContent();
            var tentativeclouser = document.forms["rbug"]["tentativeclouser"].value;
            var tech = document.forms["rbug"]["technology"].value;
            var re = /^\d{1,2}\/\d{1,2}\/\d{4}$/;
           // console.log("dsssssssf" + tech);

            if (titlebox == null || titlebox == ""|| titlebox.trim().length<1) {
                alert("Please provide valid title!");
                return false;
            }
            
            if (editorContent == '')
            {
                alert("Please provide valid description!");
                return false;
            }

            if (!$( "#proj" ).val()) {
                alert("No project exists! Please create a project first!");
                return false;
            }
              if ($( "#proj" ).val()=="0") {
                alert("Please select a project first!");
                return false;
            }
            
            if ($("#assingedto").val() == "0") {
                alert("Select a user in Assigned to");
                return false;
            }    
            

            if ($("#technology").val() == "0") {
                alert("Select a Technology");
                return false;
            }      
           /* if (tech == "select") {
                    alert("Please chose a Technology For this Bug");
                return false;
            }*/
            
     if (tentativeclouser == null || tentativeclouser == "") {
                alert("Please fill tentative Closure date!");
                return false;
            }
          

           /* if($("#proj").val() ==null)
            {
                
                alert('Project is required.')
                return false;
            }

                 if($("#assingedto").val() ==null)
            {
                alert('User to whom assign is required.')
                return false;
            }

            return false;*/

        }


        $( document ).ready(function() {
             $('.raisebug-img').addClass('active');
             var todate=new Date();
            $("#tentativeclouser").datetimepicker({
                 timepicker: false,
                format: 'm/d/y',
                 minDate:todate
            });
            Getalltech();
        });


  /*      $(function() {
        //    $("#startdate").datepicker();
            $("#tentativeclouser").datetimepicker();
        });*/
             
        tinymce.init({ menubar:false,
            selector: '#description',
        });

        function Getalltech(){
           //  alert("in all tech success");          
            var projId=$('#proj').val();
            $.ajax({
                url:'/getAlltech',
                data:{'projectId':projId},
                method: 'POST',
                success: function(data) {
                 //    alert("in all tech success");
                     console.log("---------------data-----EJS---------",data);
                    if(data.length != 0){  
                        //data=data[0];
                        console.log(data)  ;
                        $('#pStartDate').val(data[2].plannedStartDate);
                        $('#pEndDate').val(data[2].plannedEndDate);
                        $('#pEndDate').val();
                        $('#technology').html('<option value=0>-Select-</option>');
                        $('#assingedto').html('<option value=0>-Select-</option>');
                        $('#detectedBy').html('<option value=0>-Select-</option>');

                       //  $('#technology').append($("<option value=0>-Select-</option>");
                      //  $('#assingedto').append($("<option value=0>-Select-</option>"); 

                        for(var i =0;i<data[0].length;i++){   
                            $('#technology')
                            .append($("<option></option>")
                            .attr("value",data[0][i].id)              
                            .text(data[0][i].description1));          
                        }
                        for(var i =0;i<data[1].length;i++){   
                            $('#assingedto')
                            .append($("<option></option>")
                            .attr("value",data[1][i].userId)              
                            .text(data[1][i].firstName));   
                        }
                        for(var i =0;i<data[1].length;i++){   
                            $('#detectedBy')
                            .append($("<option></option>")
                            .attr("value",data[1][i].userId)              
                            .text(data[1][i].firstName));   
                        }

                    }
                },
                dataType: 'JSON'
            });
        }
        </script>
        <style> 
            #titleg {
                border-top-right-radius: 20px;
                border-top-left-radius: 20px;
            }
            #raise {
                border-radius: 10px;
            }

            .raiseBug{padding-top:3%;}
        </style>
    </head>
    <div class="fluid-container  " style="background-color:antiquewhite;margint-top:8%">
        <!-- <div class="glyphicon glyphicon-plus-sign" style="width:100%;height:20px;padding-left:20px;padding-top:10px;color:#888;font-weight: bold;">
        New Bug
    </div>
enctype="multipart/form-data"
     -->

        <center>
            <form onsubmit="return validateForm()" action="/addBug" method="post"  enctype="multipart/form-data" name="rbug" >
                <div class="row" style="width:90%;height:570px; ">
                    <div class="col-md-3" style="height:100%">
                        <center>
                            <div class="main-box-raisebug box-size " style="width:auto;height:455px;padding-bottom:2%;margin-top:4.5%;margin-left:-20%;">
                                <div class="row raiseBug" style="width:100%;height:auto;padding-top:5px;margin-left:-1px">
                                    <div class="col-md-6">
                                        <div style="width:100%;padding-top:11px;font-size:95%;margin-left:-39px"><b>Reported By</b></div>
                                    </div>
                                    <div class="col-md-6">
                                        <h4><span class="label label-info" style="padding-top:5%;padding-bottom:5%;font-size:57%"><b><%=user%></b></span></h4>
                                    </div>
                                </div>
                                <div class="row raiseBug" style="margin-top:4%; width:95%;height:auto;" align="left">
                                    <div class="col-md-5" style="width:50%" align="left">
                                        <div style="width:100%;">Project *</div>
                                    </div>
                                    <div class="col-md-7" style="width:50%" align="right">
                                        <select onchange="Getalltech()" style="width:90px;font-size:85%;padding:3%;" name="project" id="proj" >
                                            <option value="0">-select-</option>
                                            <% for(var i=0;i<project.length;i++) { %>
                                                <option value="<%=project[i].id %>">
                                                    <%=project[i].projectTitle%>
                                                </option>
                                                <%}%>
                                        </select>
                                    </div>
                                </div>
                                <hr style="max-width:100%;border-width:2px;border-color:#EDEDED">
                                <div class="row raiseBug" style="width:95%;height:auto" align="left">
                                    <div class="col-md-5" style="width:50%" align="left">
                                        <div style="width:100%;">Status *</div>
                                    </div>
                                    <div class="col-md-7" style="width:50%" align="right">
                                        <select style="width:90px;font-size:85%;padding:3%;" name="status" id="status">
                                            <option>New</option>
                                        </select>
                                    </div>
                                </div>
                                <hr style="max-width:100%;border-width:2px;border-color:#EDEDED">
                                <div class="row raiseBug" style="width:95%;height:auto" align="left">
                                    <div class="col-md-6" style="" align="left">
                                        <div style="width:100%;">Assinged To *</div>
                                    </div>
                                    <div class="col-md-6" style="width:50%" align="right">
                                        <select style="width:90px;font-size:85%;padding:3%;" name="assingedto" id="assingedto">
                                          <!--    <option value="0">-Select-</option> -->  
                                            <% for(var i=0;i<assingedto.length;i++) { %>
                                                <option value="<%=assingedto[i].id%>">
                                                    <%=assingedto[i].firstName %>
                                                </option>
                                                <%}%>
                                        </select>
                                    </div>
                                </div>
                                <hr style="max-width:100%;border-width:2px;border-color:#EDEDED">
                                <div class="row raiseBug" style="width:95%;height:auto" align="left">
                                    <div class="col-md-5" style="width:50%" align="left">
                                        <div style="width:100%;">Priority *</div>
                                    </div>
                                    <div class="col-md-7" style="width:50%" align="right">
                                        <select style="width:90px;font-size:85%;padding:3%;" name="priority" id="priority">
                                            <% for(var i=0;i<priority.length;i++) { %>
                                                <option value="<%=priority[i].id %>" <%if(priority[i].description1=="Medium" ){%>selected
                                                    <%}%> >
                                                        <%=priority[i].description1%>
                                                </option>
                                                <%}%>
                                        </select>
                                    </div>
                                </div>
                                <hr style="max-width:100%;border-width:2px;border-color:#EDEDED">
                                <div class="row raiseBug" style="width:95%;height:auto" align="left">
                                    <div class="col-md-5" style="width:50%" align="left">
                                        <div style="width:100%;">Severity *</div>
                                    </div>
                                    <div class="col-md-7" style="width:50%" align="right">
                                        <select style="width:90px;font-size:85%;padding:3%;" name="severity" id="severity">
                                            <% for(var i=0;i<severity.length;i++) { %>
                                                <option value="<%=severity[i].id %>" <%if(severity[i].description1=="Medium" ){%>selected
                                                    <%}%>>
                                                        <%=severity[i].description1%>
                                                </option>
                                                <%}%>
                                        </select>
                                    </div>
                                </div>
                                <hr style="max-width:100%;border-width:2px;border-color:#EDEDED">
                                <div class="row raiseBug" style="width:95%;height:auto" align="left">
                                    <div class="col-md-5" style="width:50%" align="left">
                                        <div style="width:100%;">Technology *</div>
                                    </div>
                                    <div class="col-md-7" style="width:50%" align="right">
                                        <select style="width:90px;font-size:85%;padding:3%;" name="technology" id="technology">
                                             <!--  <option value="0">-Select-</option>   -->
                                        <!--     <% for(var i=0;i<technology.length;i++) { console.log("techhhhhhhhhhhh",technology[i].description1) %>
                                                <option value="<%=technology[i].id %>">
                                                    <%=technology[i].description1%>
                                                </option>
                                                <%}%> -->
                                        </select>
                                    </div>
                                </div>
                                <hr style="max-width:100%;border-width:2px;border-color:#EDEDED">
                                <div class="row raiseBug" style="width:95%;height:auto" align="left">
                                    <div class="col-md-5" style="width:50%" align="left">
                                        <div style="width:100%;">Type *</div>
                                    </div>
                                    <div class="col-md-7" style="width:50%" align="right">
                                        <select style="width:90px;font-size:85%;padding:3%;" name="type" id="type">
                                            <% for(var i=0;i<type.length;i++) { %>
                                                <option value="<%=type[i].id %>">
                                                    <%=type[i].description1%>
                                                </option>
                                                <%}%>
                                        </select>
                                    </div>
                                </div>

                                <hr style="max-width:100%;border-width:2px;border-color:#EDEDED">
                                <div class="row raiseBug" style="width:95%;height:auto" align="left">
                                    <div class="col-md-5" style="width:50%" align="left">
                                        <div style="width:100%;">Detected By</div>
                                    </div>
                                    <div class="col-md-7" style="width:50%" align="right">
                                        <select style="width:90px;font-size:85%;padding:3%;" name="detectedBy" id="detectedBy">
                                           <option value="0">-select-</option>
                                           <!-- <% for(var i=0;i<allusers.length;i++) { %>
                                                <option value="<%=allusers[i].id %>">
                                                    <%=allusers[i].Name%>
                                                </option>
                                                <%}%> -->
                                        </select>
                                    </div>
                                </div>


                                          <hr style="max-width:100%;border-width:2px;border-color:#EDEDED">
                                <div class="row raiseBug" style="width:95%;height:auto" align="left">
                                    <div class="col-md-5" style="width:50%" align="left">
                                        <div style="width:100%;">Cycle</div>
                                    </div>
                                    <div class="col-md-7" style="width:50%" align="right">
                                        <select style="width:90px;font-size:85%;padding:3%;" name="cycle" id="cycle">
                                          <option value="0">-select-</option>

                                            <% for(var i=0;i<cycle.length;i++) { %>
                                                <option value="<%=cycle[i].id %>">
                                                    <%=cycle[i].description1%>
                                                </option>
                                                <%}%>
                                        </select>
                                    </div>
                                </div>



                                <hr style="max-width:100%;border-width:2px;border-color:#EDEDED">
                                <div class="row raiseBug" style="width:95%;height:auto" align="left">
                                    <div class="col-md-6" style="width:50%" align="left">
                                        <div style="width:102%;">Tentative Closure *</div>
                                    </div>
                                    <div class="col-md-6" style="width:50%;height:auto" align="right">
                                        <input type="text" name="tentativeclouser" id="tentativeclouser" style="width:90px;font-size:85%;padding:3%;" placeholder="Select date ">
                                    </div>
                                </div>
                            </div>
                        </center>
                    </div>
                    <div class="col-md-9" style=";height:90%">
                        <div style="height:50px;padding-top:10px" id="titleg">
                            <input class="form-control" type="text" maxlength="75"name="titlebox" id="titlebox" style="width:100%; float:center; " placeholder="Enter title/summary for new bug ... * ">
                        </div>
                        <div class="border-boxs" style="width:100%;height:82%;background-color:#fcfcfc">
                            <div style="width:100%">
                                <textarea name="description" id="description" class="form-control" rows="10"></textarea>
                            </div>
                            <div class="row " style="padding-top:1%;color:grey;padding-left:2.5%;" align="left">
                                <div class="col-md-1 glyphicon glyphicon-folder-open" style="color:grey;"></div>
                                <div class="col-md-2">Attach Files</div>
                                <div class="col-md-2">
                                    <input type="file" name="addBugUpload" class="upload" />
                                </div>
                            </div>
                            <input type="submit" class="label-info" name="submit" id="raise" style="color:white;background-color:#0066ff;"value="Raise Bug">
                        </div>
                    </div>
                </div>
            </form>
        </center>
    </div>

</body>
<% include ../partials/footer%>
</html>

    
