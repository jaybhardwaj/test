   <!DOCTYPE html>
<html lang="en">

	<title>All Bug</title>
	  <% include ../partials/head %>

  <% include header %>
  	   <% include ../partials/adminheader %>
  	   
  	   

	<style>
	.selectedBug{
		border: 2px solid green;

	} 
	#headMenu{
		float: right
	}
		#resizable 
		{
			min-width:100%;max-width:100% ;
  		}
 
  		.slidingpanel span
  		{
			font-size: 10px;
			font-weight: 100;
  		}

  		#commentd {
                border-radius: 10px;
            }

  		.ms-drop ul
  		{
  			max-height: 120px !important;
  		}
  	 
  		.ms-drop{
  			margin-left: 28px;
  			width: 88%;
  		}
  	
  		.ms-choice{
  			    margin-left: 28px;

  				width: 88%;
  				    margin-top: -21px;

  		}
  		.ms-choice > div{
  			    margin-top: -23px;
    right: -13px;

  		}
  		.ms-choice > span {
    position: relative;}
    sup{
    	color: white;
    	 width: 40px;
		   height: 40px;
		   background: #2A9228; 
		   -moz-border-radius: 20px; 
		   -webkit-border-radius: 20px; 
		   border-radius: 20px;
		   margin-left: 5px;
		    padding: 3px;
    } 
	</style>


<div class="se-pre-con"></div>
   <div class="secondry-color" style=" overflow-x:hidden ">		
		<div class="slidingpanel" style="font-size: 13px;font-size: 12px;">
			<div class="col-md-12" style="color:">
				<form action="/filterBug" onsubmit="return checkedBox()" method="post" class="checkl"  >
				<input class="hide" id="allSelected" name="showSelect"> 
				<div style="padding-top:10px"  >
						<label style="height:10px" >Project </label>
						<div  id="project" style="margin-left: -13px;" >
							<input type="radio" name="projectis" checked="true" value="in" id="prois">Is <input type="radio" name="projectis" value="not in" id="proisnot">Is Not
						</div>
					</div>
					<div style="position:relative; left:20%" id="16">
					 </div>  
					<div style="padding-top:10px">
						<label style="height:10px">Status </label>
						<div id="status" style="margin-left: -13px;"> 
							<input type="radio" name="statusis" checked="true" value="in" id="statusis">Is
							<input type="radio" name="statusis" value="not in" id="statusisnot">Is Not
						</div>
					</div>
					<div style="position:relative; left:20%" id="11">						
					</div>	
					<div style="padding-top:10px" >
						<label style="height:10px" >Priority </label>
						<div id="priority" style="margin-left: -13px;">
							<input type="radio" name="priorityis" checked="true" value="in" id="priois">Is<input type="radio" name="priorityis" value="not in" id="proisnot">Is Not
						</div>
					</div>
					<div style="position:relative; left:20%" id="12">
						
					</div>	
					<div style="padding-top:10px">
						<label style="height:10px">Severity</label>
						<div id="severity" style="margin-left: -13px;">
							<input type="radio" name="severityis" checked="true" value="in" id="sevis">Is<input type="radio" name="severityis" value="not in" id="sevisnot">Is Not
						</div>
					</div>
					<div style="position:relative; left:20%" id="13"> 
											</div>
					<div style="padding-top:10px">
						<label style="height:10px">Assinged To</label>
						<div id="assingedto" style="margin-left: -13px;">
							<input type="radio" name="assingedtois" checked="true" value="in" id="assis">Is<input type="radio" name="assingedtois" value="not in" id="assisnot">Is Not
						</div>
					</div>
					<div style="position:relative; left:20%" id="14">
						
					</div>
					<div style="padding-top:10px">
						<label style="height:10px">Technology</label>
						<div id="technology" style="margin-left: -13px;">
							<input type="radio" name="technologyis" checked="true" value="in" id="techis">Is <input type="radio" name="technologyis" value="not in" id="techisnot">Is Not
						</div>
					</div>
					<div style="position:relative; left:20%" id="15">
					</div>
					<center>
						<input type="submit" style="padding: 4px;padding-left:10px;padding-right:10px;margin-top:5px;margin-bottom:5px;" value="Filter" />
					</center>
				</form>
			</div>
		</div> 


 <label href="javascript:void(0);" class="slider-arrow show" style="float:left">Filter &laquo;</label>

 <div class="row" style="padding:2%;padding-top:5px;padding-bottom:0px">
 <!-- 
	<span class="modal-title" style="padding-left:45%">Bug Details</span> 	
	
	<input class="form-text-box" type="text" placeholder="Bug Id,Project,Created Date" id="searchbox" style="margin-top: 5px;margin-bottom: 5px;float:right;width: 13%;"> 
	 <label style="float:right;padding-top:1%;padding-right:3px" class="form-Label">Search : </label> -->
	
<div style="overflow-x:auto; width:100%">
            <table id="data_table" class="table table-striped table-bordered" 	cellspacing="0" width="100%" style="ALIGN-CONTENT: CENTER;">
                <thead>
                <tr>
                    <th>S.No.</th>
                    <th>Bug ID</th>
                    <th>Title</th>
                    <th>Project</th>
                    <th>Status</th>
                    <th>Priority</th>
                    <th>Severity</th>
                    <th>Technology</th> 
                    <th>Esti. Effort</th>
                    <th>Actual Effort</th>
                    <th>Assinged To</th>
                    <th>Created Date</th>
                    <th>Closure Date</th>
                    </tr>
                </thead>	
                <tbody id="bugDetails">
                 <% var c=0;
						 for(var j=0;j<bug.length;j++){   %>
                        <tr class="rows" id="vbug-sbox_<%=j%>" checked="true" onclick="showdetails(<%=bug[j].id%>,<%=j%>)">
                            <td align="center">
								<%=++c%>
                            </td>
                            <td class="col-md-1" align="center" style="width:84px">
                               <span><%=bug[j].id%></span> 
                            </td>
                            <td class="col-md-2">
                                <input type="hidden" id="hiddentitle<%=j%>" onchange="updatebugdetails(<%=bug[j].id%>,this,'bugTitle')" value="<%=bug[j].bugTitle%>">
                                <input type="text" id="bugtitle<%=j%>" style="width:100%;background-color:none;border:none" maxlength="75" onchange=" updatebugdetails(<%=bug[j].id%>,this,'bugTitle',<%=j%>)" value="<%=bug[j].bugTitle%>">
                            </td>
                            <td>
                                <span><%=bug[j].projectTitle%></span>
                            </td>
                            <td class="col-md-1">
                        <select  class="select-vbug"  onchange="updatebugdetails(<%=bug[j].id%>,this,'status')">
             						<% for(var i=0;i<status.length;i++) { %>
									<%if(status[i].description1 != 'Close'){ %>             					
                    				<option value="<%=status[i].id%>" <%if(bug[j].status== status[i].id){%> selected <%}%>>
										<%=status[i].description1%>    
                    				</option> 
                    				<%} else {%>

                    					 <%if(status[i].description1 == 'Close' && (  bug[j].createdBy ==userid || roleid==1)){ %> 
									<option value="<%=status[i].id%>" <%if(bug[j].status == status[i].id){%> selected <%}%>>
										<%=status[i].description1%>    
                    				</option> 
                    				   	<%}%>       
                    				   	<%}%>     
										<%}%>
               					</select> 
                            </td>
                            <td>
                            	<select class="select-vbug" onchange="updatebugdetails(<%=bug[j].id%>,this,'priority')">
                					<% for(var i=0;i<priority.length;i++) { %>
               						<option value="<%=priority[i].id %>" <%if(bug[j].priority == priority[i].id){%> selected <%}%>>
									<%=priority[i].description1%>    
                					</option>
                					<%}%>
                				</select>
                            </td>
                            <td>
                            	<select class="select-vbug" onchange="updatebugdetails(<%=bug[j].id%>,this,'severity')">
       	        					<% for(var i=0;i<severity.length;i++) { %>
                					<option value="<%=severity[i].id %>" <%if(bug[j].severity == severity[i].id){%> selected <%}%>>
										<%=severity[i].description1%>    
       	        					</option>
                					<%}%>
                				</select>
                            </td>
                            <td>
                            	<select class="select-vbug" onchange="updatebugdetails(<%=bug[j].id%>,this,'technology')">
                  					<% for(var i=0;i<technology.length;i++) { %>
                    				<option value="<%=technology[i].id %>" <%if(bug[j].technology== technology[i].id){%> selected <%}%> >
										<%=technology[i].description1%>    
                    				</option>
									<%}%>
                				</select>
                            </td>
                            
                                <td> 
                            	<input class=""  id='estimatedEffort+<%=j%>' onblur="updatebugdetails(<%=bug[j].id%>,this,'estimatedEffort',this.id,'<%=bug[j].enddate%>')" value="<%=bug[j].estimatedEffort%>" style="border:none;"  >
                            </td>
                                <td> 
                            	<input class=""  id='actualEffort+<%=j%>' onblur="updatebugdetails(<%=bug[j].id%>,this,'actualEffort',this.id,'<%=bug[j].enddate%>')" value="<%=bug[j].actualEffort%>" style="border:none;"  >
                            </td>
                            <td>
                            	<select style="width:70%" class="select-vbug" onchange="updatebugdetails(<%=bug[j].id%>,this,'assingedToUserId')">
                  					<%  for(var i=0;i<assingedto.length;i++) { %>
 									<% if(assingedto[i].projectId==bug[j].projectId){%>
                  					<option value="<%=assingedto[i].userId%>" <%if(bug[j].assingedToUserId==assingedto[i].userId){%> selected <%}%>>
							  		<%=assingedto[i].name%>   
                  					</option>
										<%}%>
											<%}%>
                				</select>
                            </td>
                            <td>
                            	<%=bug[j].startdate%>
                            </td>
                            <td>

 <input class="datepicker select-vbug11"  id='end+<%=j%>' onchange="updatebugdetails(<%=bug[j].id%>,this,'effectiveEndDate',this.id,'<%=bug[j].enddate%>')" style="border:none;" <% if(bug[j].enddate!='00/00/00'){%>value=<%=bug[j].enddate%> <%}else{%> value=''<%}%>>
                            </td>
                        </tr>

                        <%}%>   	
                </tbody>
            </table>
            </div>
        </div>
		

		<div class="row secondry-color" style="width:98%;margin-left:1%;padding-top:5px;padding-bottom:1%;">
			<div class="col-md-12" style=" height:auto;width:100%;padding-right:0px;padding-left:0px" >
				<ul class="nav nav-tabs" style="background-color:none;font-size:13px">
					<li class="active"><a data-toggle="tab" href="#home">Description</a></li>
					<li><a data-toggle="tab" href="#menu1">Overview</a></li>
					<li><a data-toggle="tab" href="#menu2">Comment<sup id="commCount"></sup></a></li>
					<li><a data-toggle="tab" href="#menu3">Attachment<sup id="attCount"></sup></a></li> 
				</ul>
				<div class="tab-content" >

					<input type="hidden" name="bugidhidden" id="bugidhidden" value=""/>
					<div style="margin-left:-1%;width:102%" id="home" class="tab-pane fade in active">	
					 	<div class="row" style="margin-top:10px">
				    		<div class="col-md-1" style ="padding-left:2%;padding-top:5px;color:#f05f40;">Title:</div>
							<div class="col-md-2" id="title" style="padding-top:5px;font-size:12px"></div>
							<div class="col-md-2" style ="padding-left:2%;padding-top:5px;color:#f05f40;">Linked Task :</div>
							<div class="col-md-6">
							<select class="form-text-box" id="linkedTo" name="linkedTo">
							<% for(var i=0;i<linkTo.length;i++) { %>
                    				<option value="<%=linkTo[i].id %>"><%=linkTo[i].name%>    
                    				</option>
									<%}%>
                			</select></div>
							<div class="col-md-1" style=";margin-left:-1%;padding-top:5px;">
								<button type="button" class="btn btn-primary btndesc hide" onclick="return updatebugdescription()"  style="float:right;height:auto;padding:3px 8px;margin-bottom:1%">Update</button>
							</div>
						</div>

				<input type="text" name="bugDescription" id="bugDescription" class="hide">
				<textarea style="float:left;width:101%"  maxlength="12000" id='description' class='form-control'></textarea>
						
					</div>
					<div id="menu1" style="margin-left:-1%;width:102%" class="tab-pane fade">
						<div id="overview" style="margin-bottom:1%;margin-top:10px"></div>
					</div>
					<div id="menu2" style="margin-left:-1%;width:102%" class="tab-pane fade">
					<div >
						<textarea maxlength="200" name='commenttext' style="margin-top:10px;resize:none" id='commenttext' class='form-control' rows=4 placeholder='Write your comment here ...'></textarea>
						<input type='button' class="btn" value='Add Comment' id="commentd" style='margin-top:1%;' onclick='addcomment()'>
						<div id="comment" style="overflow-y:auto;height:145px !important"></div>
					</div>
					</div>
					<div id="menu3" style="margin-left:-1%;width:102%" class="tab-pane fade">
						<div class="" style="margin-top:20px;margin-bottom:50px">
							<label class="" style="font-size:14px;color:#f05f40;margin-left:1.5%;">Upload File </label>
					  		<form  id="form123" method="post" style="margin-left:1%;" enctype="multipart/form-data" name="comment">
					  			<input type="file" id="fupUploadSheet" name="addBugAttachment" class="upload" onchange="UploadSheet()"/>
					  			(Max. Size:2Mb)
					  			
							</form> 

						</div>
							<div id="attachment" style=''><p></p></div>				  
					</div>
				</div>
			</div>
		</div>
		</div>	

	<%include ../partials/footer.ejs%>

 
<script> 
        $('body').on('focus',".select-vbug11", function(){
 
 
 $(this).datetimepicker({
                 timepicker: false,
                format: 'm/d/y',
               
            });});
          
function checkedBox(){
var array = [];
var radio=[];
    $('.checkl  option:selected').each(function() {
        array.push($(this).attr("id"));
    });
  
    $('.checkl  :radio:checked').each(function() {
       radio.push($(this).attr("id")); 
    });
    
    array.push.apply(array,radio); 
	    $("#allSelected").val(array); 
	return true;
}

 	$(document).ready(function(){ 
 		      otable = $("#data_table").DataTable({ 
                "info":false,
                "bSort":false,
                "lengthMenu":[[5,10,20,-1],[5,10,20,"All"]],
                "columnDefs": [ {"targets": [0,1],"width": "20px"},
						       {"targets": 2,"width": "50px"},
						       {"targets": [3,4,5,6,7],"width": "auto"}
						       ]         
            });
 		$("#searchbox").keyup(function() {
        otable.search(this.value).draw();

      }); 
 		 otable.$('tr:first').click();
 		$('.se-pre-con').fadeOut('slow'); 
		$('#download').removeClass("hide");
		$('#downloadL').removeClass("hide");

		var newArr="<%=showSelect%>".split(",");
	  
		$("input:radio").each(function () {
			var currid=$(this).attr("id");
			if(newArr.indexOf(currid)!=-1){
				$(this).attr("checked",true);
			}
		});

var str='<select name="project" id="projects" multiple="" style="width:100%;margin-top:10px;">';
					 	<% for(var i=0;i<project.length;i++) { %>
					 		var selectpro='';
					 		if(newArr.indexOf("pro_<%=project[i].id%>")!=-1){ 
					 			selectpro="selected";
					 		}
					 	str=str+'<option id="pro_<%=project[i].id%>" '+selectpro+' value="<%=project[i].id%>"><%=project[i].projectTitle%></option>';
						<%}%> 
str=str+'</select>';  
 		$("#16").append(str); 
		var str='<select name="status" id="statuss" multiple="" style="width:100%;margin-top:10px;">';
					 	<% for(var i=0;i<status.length;i++) { %>
					 		var selectstat='';
					 		if(newArr.indexOf("sta_<%=status[i].id%>")!=-1){ 
					 			selectstat="selected";
					 		}
					 	str=str+'<option id="sta_<%=status[i].id%>" '+selectstat+' value="<%=status[i].id%>"><%=status[i].description1%></option>';
						<%}%> 
str=str+'</select>'; 
 		$("#11").append(str); 
 		str='<select name="priority" id="prioritys" multiple="" style="width:100%;margin-top:10px">';
					<% for(var i=0;i<priority.length;i++) { %>
						    var selectprio='';
					 		if(newArr.indexOf("pri_<%=priority[i].id %>")!=-1){ 
					 			selectprio="selected";
					 		}
						str=str+'<option id="pri_<%=priority[i].id %>"  '+selectprio+'  value="<%=priority[i].id %>"><%=priority[i].description1%></option>';
						<%}%> 
						str=str+'</select>'; 
						$("#12").append(str); 
						str=' <select name="severity" id="severitys" multiple="" style="width:100%;margin-top:10px">';
						<% for(var i=0;i<severity.length;i++) { %>
							var selectseve='';
					 		if(newArr.indexOf("sev_<%=severity[i].id %>")!=-1){ 
					 			selectseve="selected";
					 		}
						str=str+'<option id="sev_<%=severity[i].id %>" '+selectseve+' value="<%=severity[i].id %>" ><%=severity[i].description1%></option>';
							<%}%> 
			 			str=str+'</select>'; 
						$("#13").append(str); 
						str=' <select size="5"name="assingedto" class="sel" id="assingedtos" multiple="" style="width:100%;margin-top:10px">';
						<%for(var i=0;i<allusers.length;i++) {%>
							var selectasto='';
					 		if(newArr.indexOf("asto_<%=allusers[i].userId%>")!=-1){ 
					 			selectasto="selected";
					 		}
						str=str+'<option id="asto_<%=allusers[i].userId%>" '+selectasto+' value="<%=allusers[i].userId%>" ><%=allusers[i].Name%></option>';
						<%}%> 
						str=str+'</select>'; 
						$("#14").append(str); 
            			str='<select name="technology" id="technologys" multiple="" style="width:100%;margin-top:10px">';
							<% for(var i=0;i<technology.length;i++) { %>
								var selecttech='';
					 		if(newArr.indexOf("tech_<%=technology[i].id %>")!=-1){ 
					 			selecttech="selected";
					 		}
							str=str+'<option id="tech_<%=technology[i].id %>" '+selecttech+'  value="<%=technology[i].id %>" ><%=technology[i].description1%></option>';
							<%}%> 
            			str=str+'</select>';

		$("#15").append(str);  
		$("#pro_93").addClass('selected');
 		 $('.viewbug-img').addClass('active');
 		//$( "#resizable" ).resizable(); 
 		//$('#bugtitle0').click(); 
 		$('.select-vbug').css('cursor', 'pointer');

		 //$( "#resizable" ).resizable(); 
		 $('#projects').change(function() { 
        }).multipleSelect({
            width: '75%'
        }); 
		$('#statuss').change(function() { 
        }).multipleSelect({
            width: '75%'
        });

		$('#prioritys').change(function() { 
        }).multipleSelect({
            width: '75%'
        });

        $('#severitys').change(function() { 
        }).multipleSelect({
            width: '75%'
        });

        $('#assingedtos').change(function() { 
        }).multipleSelect({
            width: '75%'
        });
        $('#technologys').change(function() { 
        }).multipleSelect({
            width: '75%'
        });

	
      

		//....................Side filter...................

 		$('.slider-arrow').click(function() {
			if ($(this).hasClass('show')) {
        		$(".slider-arrow, .slidingpanel").animate({
          			left: "+=20%"
        		},
        		700, function () {
          			// Animation complete.
          		});
          		$(this).html('Filter &laquo;').removeClass('show').addClass('hide1');
      		} else 
      		{
        		$(".slider-arrow, .slidingpanel").animate({
        			left: "-=20%"
        		},700, function () {
          			// Animation complete.
          			});
          		$(this).html('&laquo; Filter').removeClass('hide1').addClass('show');
        	}
    	});
    	var todate=new Date();
    	/*alert(todate);*/
    	 $(".datepicker").datetimepicker({
                 timepicker: false,
                format: 'm/d/y',
                minDate:todate
            });
		//$('.datepicker').datepicker();
 	});

	tinymce.init({ menubar:false,
        selector: '#description',
        width: "100%",
        toolbar:'undo redo | styleselect | bold italic | bullist | numlist'
    });	 
	
  	//.........................Re Show  comment on comment button click................................
  	function showcomment(data) {
  	console.log("recent comment added :",data)	;
		$('#comment').html(''); 
		$('#commCount').html(data[0].length);
		var com='';
		for(var i=(data[0].length)-1;i>=0;i--) {
			//alert(data[0][i].createdDate);
			data[0][i].createdDate=new Date(data[0][i].createdDate);
			var str=data[0][i].createdDate.toString();
			com=com+"<div class='comment-border' style='vertical-align:bottom;background-color:#c7defe;margin:1%;'><div style='background-color:#F0FAFF;width:100%'><div style='font-size:10px;float:left;padding-left:20px'>"+"  "+"</div><div style='font-style:italic;padding-left1%;'> By : "+data[0][i].firstName+":"+str.slice(0,-8)+"</div></div><div style='float:left;padding-left:20px;width: 100%;background-color:#C7DEFE;max-height:100px; word-wrap: break-word;'>"+data[0][i].comments+"</div><br><div style='width:100%'></div></div>";
		}
		$('#comment').html(com);
	}
		
	function showattachment(data) {	
	  	var att='';
			$('#attCount').html(data.length); 
		for(var i=(data.length)-1;i>=0;i--){ 
			var deleteBtn=''
			  if(data[i].userId=='<%=userid%>' || '<%=roleid%>'==1)
				{
					deleteBtn="<span class='glyphicon glyphicon-trash' style='float:right;margin:6px' title='Delete' onclick='deleteAttach("+data[i].id+")'></span>";
				}
				var dat=(new Date(data[i].createdDate).toString());
				dat=dat.slice(0,24);
			att=att+"<div class='border-box hov-shadow'style='width:130px;float:left;margin-left:10px' id='"+data[i].id+"'><a href='"+data[i].orignalFilePath+"' download ><img src='"+data[i].orignalFilePath+"' style='width:100px;height:100px'></a>"+deleteBtn+"<div style='color:grey;font-size:10px'>Added by:"+data[i].firstName+" On:"+dat+"</div></div>"
		 
		}
		$('#attachment').html(att);
	}
	function deleteAttach(attid){  
		if(confirm("You Want to delete this attachment?")){
		$.ajax({
			data: {"aatachId":attid},
			url: '/deleteBugAttach',
			method: 'post',
			success: function(data) {
				$("#"+attid).html('');
				$("#"+attid).attr("class",'');
				$("#"+attid).attr("style",'');
				alert("Attachment deleted Successfuly!");
				var count=$('#attCount').text();
				$('#attCount').html(count-1);
			}
		});
	}
	}

//.............save/add comment to database......................			
  	function addcomment() { 		 
 		//var url = window.location.origin.split("/")[3] ? window.location.origin : window.location.origin   + '/buguser' +'/addcomment';
		if (!$.trim($("#commenttext").val())){
			alert("please enter valid comment");
			return false;
		} else
		{	var comm={
				data: {comment:$('#commenttext').val(),bugid:$("#bugidhidden").val()},
				url: '/addComment',
				method: 'POST',
				dataType: 'JSON',
				success:function(data){
					if(data.length>0)
					{ 
						showcomment(data);
					}
				},
			}
			$.ajax(comm);
		}
		$('#commenttext').val('');
	}


//....................adding values to the respective DIV................
  
	function showdetails(bid,divId){
		//alert(bid);
		//$('.vbug-box').attr("color","yellow");
		//$('.vbug-box').css("border","none");
		//$("#vbug-sbox_"+divId).css("border-style","groove");
		  $(".rows").css({"background-color":"white"});
		$("#vbug-sbox_"+divId).css({"background-color":"#CBDDEA"});
		//alert("show details"+bid)
		$("#bugidhidden").val(bid);
		//alert($("#bugidhidden").val());
		$.ajax({
			data: {"bugid":bid},
			url: '/bugDetails',
			method: 'post',
			success: function(data) {
			console.log("bug info:",data);	 
				$('#title').html($("<label>"+data[0][0].bugTitle+"</label>"));
				$('#linkedTo').val(data[0][0].linkedTask);
				tinyMCE.activeEditor.setContent(data[0][0].bugDescription);
				/*if(!data[0][0].enddate){
					data[0][0].enddate="No End Date Assinged"
				}
				if(!data[0][0].CycleNo){
					data[0][0].CycleNo="No Cycle";
				}*/

var over='';
		over=over+"<table style='width:100%'><tr><td><label class='form-Label'>Project Title   : </label>"+data[0][0].projectTitle+"</td>";
		over=over+"<td><label class='form-Label'>Assinged To   : </label> "+data[0][0].firstName+"</td>";
		over=over+"<td><label class='form-Label'>Technology   : </label> "+data[0][0].technology+"</td>";
		over=over+"<td><label class='form-Label'>Bug Status   : </label> "+data[0][0].statusName+"</td></tr>";
		if(data[0][0].CycleNo){
		over=over+"<td><label class='form-Label'>Cycle  : </label> "+data[0][0].CycleNo+"</td>";
		}if(data[0][0].bugType){
			over=over+"<td><label class='form-Label'>Bug Type   : </label> "+data[0][0].bugType+"</td>";
		}if(data[0][0].detectedByName){
			over=over+"<td><label class='form-Label'>Detected By   : </label> "+data[0][0].detectedByName+"</td>";
		} if(data[0][0].enddate){
			over=over+"<td><label class='form-Label'>Tentative Clouser    : </label> "+data[0][0].enddate+"</td>"
		} 
		over=over+"</tr></table>";
		$("#overview").html(over);
 
				$('#comment').html('');
				$('#commCount').html(data[1].length);
				var com='';

				for(var i=(data[1].length)-1;i>=0;i--) { 
					data[1][i].createdDate=new Date(data[1][i].createdDate);
					var str=data[1][i].createdDate.toString();
				   com=   com+"<div class='comment-border' style='vertical-align:bottom;background-color:#c7defe;margin:1%'><div style='background-color:#F0FAFF;width:100%'><div style='font-size:10px;float:left;padding-left:20px'>"+"  "+"</div><div style='font-style:italic;padding-left:1%;'>By : "+data[1][i].firstName+":"+str.slice(0,-8)+"</div></div><div style='float:left;padding-left:20px;width: 100%;max-height:100px; word-wrap: break-word;background-color:#C7DEFE;'>"+data[1][i].comments+"</div><br><div style='width:100%'></div></div>";
				}  
				$('#comment').html(com); 
				$('#attachment').html('');
				$('#attCount').html(data[2].length);
			  var att='';
			 
					  
			  for(var i=(data[2].length)-1;i>=0;i--)
				{  
					 var deleteBtn=''
			  if(data[0][0].createdBy=='<%=userid%>' || '<%=roleid%>'==1)
				{
					deleteBtn="<span class='glyphicon glyphicon-trash' style='float:right;margin:6px' title='Delete' onclick='deleteAttach("+data[2][i].id+")'></span>";
				}
				var dat=(new Date(data[2][i].createdDate).toString());
				dat=dat.slice(0,24);
				  att=att+"<div class='border-box hov-shadow'style='width:130px;float:left;margin-left:10px' id='"+data[2][i].id+"'><a href='"+data[2][i].filePath+"' download> <img src='"+data[2][i].filePath+"' style='width:100px;height:100px'> </a>"+deleteBtn+"<div style='color:grey;font-size:10px'>Added by:"
					+data[2][i].firstName+" On:"
					+dat+"</div></div>";

					
				}
				$('#attachment').html(att);


			if(data[0][0].createdBy=='<%=userid%>' || '<%=roleid%>'==1)
			{
$(".btndesc").removeClass('hide');
					tinyMCE.get('description').getBody().setAttribute('contenteditable', true);

			}
			else{
				$(".btndesc").addClass('hide');
					tinyMCE.get('description').getBody().setAttribute('contenteditable', false);
			}

			},
			dataType: 'JSON',
		});
	} 


	// ............attechment start........................
	function UploadSheet(){
		//var data1=$('#fupUploadSheet').val();
		var input, file;
            input = document.getElementById('fupUploadSheet');
            file = input.files[0];
             if(file.size>2097152){
                 alert("Error:File limit is 2 mb");
                 return false ;
            } 


		var data1 = new FormData($('#form123')[0]);
		var files = $("#fupUploadSheet").val();
    	var id1=$("#bugidhidden").val();
		data1.append('id',id1);
	
 	 	$.ajax({
  			url:'/bugAttachment',
  	 		method: 'POST',
    		data:data1,
    		contentType: false, 
   			processData: false,
			success: function(data) {
				console.log("after upload :",data);
				alert("File uploaded successfully!");
				showattachment(data);
			},
			dataType: 'JSON',
		});
	}
	//....................Save bug details......................
 
	function updatebugdetails(bugid,e,type,id,endate){
 	 
if(type=='effectiveEndDate')
   {     
	var up ={
		data: {"bugid":bugid,"value":e.value,"colname":type},
			url: '/updatebugdetails',
			method: 'POST',
			success: function(data) {
				showdetails(bugid);
			 },
			dataType: 'JSON',
			};
			$.ajax(up);


			return;
}

	  	if ( e.value == null || e.value == ""|| e.value.trim().length < 1) {
	  		alert("Please enter a valid title for bug!"); 
	  		$('#bugtitle'+id).val($('#hiddentitle'+id).val());
	  	} else 
	  	{	
	  	if(type=='assingedToUserId'&&confirm("Are you sure you want to change the assinged to ?")){
	  		var up ={data: {"bugid":bugid,"value":e.value,"colname":type},
			url: '/updatebugdetails',
			method: 'POST',
			success: function(data) {
				showdetails(bugid);
			 },
			dataType: 'JSON',
			};
			$.ajax(up);
		}
		else{
	  		var up ={data: {"bugid":bugid,"value":e.value,"colname":type},
			url: '/updatebugdetails',
			method: 'POST',
			success: function(data) {
				showdetails(bugid);
			 },
			dataType: 'JSON',
			};
			$.ajax(up);
		}
		}
	}

	function updatebugdescription() {
var ds=tinyMCE.activeEditor.getContent();
 			if(ds.trim().length<=0){
 				alert("Description can not be left blank");
 				return false;
 			}
 			if(ds.trim().length>12000){
 				alert('Description length should not be more than 12000 characters');
 				return false;
 			}  
	 		$.ajax(
			{
				data: {
					"bugid":$("#bugidhidden").val(),
					"description": ds,
					"linkedTo":$("#linkedTo").val()
				},
				url: '/updatebugdescription',
				method: 'POST',
				success: function() {	
				alert("Bug description updated succesfully!");		
				},			 
				dataType: 'JSON',
			});
 	} 

function exportBug()
{
	 $(".se-pre-con").fadeIn("slow");
var header=['S.No.', 'Title', 'Project', 'Status', 'Priority', 'Severity', 'Technology', 'Assinged To', 'Start Date', 'End Date'];

var url = window.location.origin.split("/")[3] ? window.location.origin : window.location.origin + '/getAllBugtoexport';
$.ajax({
url: url,
method: 'POST',
data : {},
success: function(bugData) { 
bugData.unshift(header);
alasql("SELECT * INTO CSV('bug_Report.csv') FROM ?",[bugData]);
/*$(".se-pre-con").fadeOut("slow");
$("#btnDownloadbug").prop('disabled', false);*/
},
dataType: 'JSON',
});   

$(".se-pre-con").fadeOut("slow");
}
	</script>


	 <script src="http://alasql.org/console/alasql.min.js"></script>
</body>
</html>
